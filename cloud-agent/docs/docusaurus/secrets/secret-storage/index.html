<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-docs docs-version-current docs-doc-page docs-doc-id-cloud-agent/docs/docusaurus/secrets/secret-storage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Secret storage | Hyperledger Identus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hyperledger-identus.github.io/docs/cloud-agent/docs/docusaurus/secrets/secret-storage"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs-current"><meta data-rh="true" property="og:title" content="Secret storage | Hyperledger Identus"><meta data-rh="true" name="description" content="Status: draft"><meta data-rh="true" property="og:description" content="Status: draft"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hyperledger-identus.github.io/docs/cloud-agent/docs/docusaurus/secrets/secret-storage"><link data-rh="true" rel="alternate" href="https://hyperledger-identus.github.io/docs/cloud-agent/docs/docusaurus/secrets/secret-storage" hreflang="en"><link data-rh="true" rel="alternate" href="https://hyperledger-identus.github.io/docs/cloud-agent/docs/docusaurus/secrets/secret-storage" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BLNS09BXBY"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BLNS09BXBY",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.e9647785.css">
<script src="/docs/assets/js/runtime~main.e5ae3038.js" defer="defer"></script>
<script src="/docs/assets/js/main.d1a3c933.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/identus-navbar-light.png" alt="Identus logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/identus-navbar-light.png" alt="Identus logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/documentation/learn/">Learn</a><a class="navbar__item navbar__link" href="/docs/documentation/developers/">Developers</a><a class="navbar__item navbar__link" href="/docs/documentation/reference/">Reference</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Secret storage</h1></header>
<p><strong>Status</strong>: draft</p>
<p><strong>Date</strong>: 2021-06-02</p>
<p><strong>NOTE</strong>: this document is a draft and is not implemented yet. Statement in this document might be changed in the future.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h2>
<p>Secrets are sensitive data that should be stored securely.
There are following types of the secrets in the Identus Platform:</p>
<ul>
<li class="">seed: a secret used to derive cryptographic keys</li>
<li class="">private key: a secret used to sign data</li>
<li class="">any other entities that contain sensitive data (for instance, <code>credential-definition</code> and the <code>link-secret</code> used by the AnonCreds)</li>
</ul>
<p><strong>NOTE</strong>: public keys are not considered as secrets and can be stored in the same of other storage depending on the needs</p>
<p>The Identus Platform provides a secure storage for secrets.
Hashicorp Vault is used as a secret storage service and provides a REST API, Web UI and command client to interact with the service.</p>
<p><strong>NOTE:</strong> The Identus Platform uses a single Vault instance for all tenants per environment. Logical data separation is achieved by using Vault namespaces and policies applied to the tenant.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="terminology">Terminology<a href="#terminology" class="hash-link" aria-label="Direct link to Terminology" title="Direct link to Terminology" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="vault">Vault<a href="#vault" class="hash-link" aria-label="Direct link to Vault" title="Direct link to Vault" translate="no">​</a></h3>
<p>Vault is a secrets management service developed by HashiCorp.
It can be used as the default secret storage for the Identus Platform as well as for authentication and account management.</p>
<p><strong>NOTE</strong>: The Identus Platform must not be dependent on the Vault service and must be able to use other services for the same purposes</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="agent">Agent<a href="#agent" class="hash-link" aria-label="Direct link to Agent" title="Direct link to Agent" translate="no">​</a></h3>
<p>The Cloud Agent is a service that provides an APIs to interact with the Identus Platform and use the SSI capabilities.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="wallet">Wallet<a href="#wallet" class="hash-link" aria-label="Direct link to Wallet" title="Direct link to Wallet" translate="no">​</a></h3>
<p>Logical component of the Agent that holds secrets and provides the logical or physical isolation of the data.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="technical-overview">Technical Overview<a href="#technical-overview" class="hash-link" aria-label="Direct link to Technical Overview" title="Direct link to Technical Overview" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-cloud-agent-logical-isolation">The Cloud Agent Logical Isolation<a href="#the-cloud-agent-logical-isolation" class="hash-link" aria-label="Direct link to The Cloud Agent Logical Isolation" title="Direct link to The Cloud Agent Logical Isolation" translate="no">​</a></h3>
<p>Each instance of the Cloud Agent needs to have access to the secrets but must be isolated from other agents at the same environment.
For horizontal scalability the group of agents can be configured to share the same namespace, so they can access the same secrets, but they still need to use different Vault account to authenticate themselves to the Vault service.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-cloud-agent-authentication">The Cloud Agent Authentication<a href="#the-cloud-agent-authentication" class="hash-link" aria-label="Direct link to The Cloud Agent Authentication" title="Direct link to The Cloud Agent Authentication" translate="no">​</a></h3>
<p>Each instance of the Cloud Agent needs to authenticate itself to the Vault service.
The Vault service uses a token-based authentication mechanism.
The Cloud Agent uses a Vault <a href="https://developer.hashicorp.com/vault/docs/auth/approle" target="_blank" rel="noopener noreferrer" class="">AppRole</a> authentication method to authenticate itself to the Vault service.
The token issued to the agent has the expiration time set in the application configuration.
After the token expires, the agent needs to re-authenticate itself to the Vault service.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="wallet-authentication">Wallet Authentication<a href="#wallet-authentication" class="hash-link" aria-label="Direct link to Wallet Authentication" title="Direct link to Wallet Authentication" translate="no">​</a></h3>
<p>Each instance of the Wallet needs to authenticate itself to the Vault service.
The Cloud Agent issues the authentication token to the Wallet based on the tenant ID.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="secrets-engine-configuration">Secrets Engine Configuration<a href="#secrets-engine-configuration" class="hash-link" aria-label="Direct link to Secrets Engine Configuration" title="Direct link to Secrets Engine Configuration" translate="no">​</a></h3>
<p>The Vault service uses a secrets engine to store secrets.
KV2 secrets engine is used to store secrets in the Vault service and provides the following features:</p>
<ul>
<li class="">secrets are encrypted at rest</li>
<li class="">secrets are encrypted in transit</li>
<li class="">secrets are versioned</li>
<li class="">secrets can be deleted, restored and rolled back to a previous version</li>
<li class="">secrets are available via REST API, WEB UI, and command client</li>
<li class="">secrets are logically separated by tenants</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="single-and-multi-tenant-configuration">Single and Multi-Tenant Configuration<a href="#single-and-multi-tenant-configuration" class="hash-link" aria-label="Direct link to Single and Multi-Tenant Configuration" title="Direct link to Single and Multi-Tenant Configuration" translate="no">​</a></h3>
<p>The Identus Platform supports single and multi-tenant configurations.
In the single-tenant configuration, the Cloud Agent uses a single Wallet and a single Vault account to authenticate itself to the Vault service.
In the multi-tenant configuration, the Cloud Agent manages multiple Wallets, each Wallet is associated with a single tenant.
Multi-tenant configuration is used to achieve logical data separation between tenants, so each Wallet can access only its own secrets.
The Wallet is identified by the tenant ID and represented by the account in the Vault service.</p>
<p>The common sequence diagram for the single and multi-tenant configurations is shown below:</p>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-derivation">Key Derivation<a href="#key-derivation" class="hash-link" aria-label="Direct link to Key Derivation" title="Direct link to Key Derivation" translate="no">​</a></h3>
<p>The Identus Platform uses HD key derivation to derive cryptographic keys from the seed.
The Wallet is initialized with the seed and uses it to derive cryptographic keys for managed DIDs.
Key derivation path is conventional and is defined as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">m / wallet-purpose / DID-index / key-purpose / key-index</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="naming-convention">Naming Convention<a href="#naming-convention" class="hash-link" aria-label="Direct link to Naming Convention" title="Direct link to Naming Convention" translate="no">​</a></h3>
<p>To store the assets in the Vault service each asset is assigned a unique name.
The Vault is a key/value store with metadata attached to the key and versioning.</p>
<p>The naming convention for the Vault assets is a matter of the implementation, but for the multi-tenant configuration all the assets of the Wallet must be stored under the path that contains the <code>tenant-id</code>.</p>
<p>For example, the <code>seed</code> can be stored by the following path:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;tenant-id&gt;/seed value=&lt;base64-encoded-value&gt; &lt;metadata&gt;</span><br></span></code></pre></div></div>
<p>The private keys for the DID can be stored by the following path:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;tenant-id&gt;/dids/prism/&lt;did-ref&gt;/keys/&lt;key-purpose&gt;/&lt;key-index&gt;/&lt;operation-hash&gt; value=&lt;base64-encoded-value&gt; &lt;metadata&gt;</span><br></span></code></pre></div></div>
<p>where:</p>
<ul>
<li class=""><code>tenant-id</code> is the tenant ID assigned to the Wallet</li>
<li class=""><code>did-ref</code> is the DID ref</li>
<li class=""><code>key-purpose</code> is the key purpose according to the PRISM DID Method specification</li>
<li class=""><code>key-index</code> is the key index. Starts from 0 and grows incrementally after each key rotation</li>
<li class=""><code>operation-hash</code> is the reference to the update DID document operation</li>
<li class=""><code>base64-encoded-value</code> is the base64-encoded value of the key</li>
<li class=""><code>metadata</code> is the key/value metadata attached the key that can be used to store additional information about the key such as <code>seed</code> or <code>key-derivation-path</code></li>
</ul>
<p>The keys material of the DID peer can be stored by the following path:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;tenant-id&gt;/dids/peer/&lt;did-ref&gt;/keys/&lt;key-purpose&gt; value=&lt;base64-encoded-value&gt; &lt;metadata&gt;</span><br></span></code></pre></div></div>
<p>Links:</p>
<ul>
<li class=""><a href="https://github.com/input-output-hk/prism-did-method-spec" target="_blank" rel="noopener noreferrer" class="">PRISM DID Method Specification</a></li>
<li class=""><a href="https://www.vaultproject.io/api/secret/kv/kv-v2" target="_blank" rel="noopener noreferrer" class="">Vault Secrets Engine API</a></li>
<li class=""><a href="https://www.vaultproject.io/docs/concepts/namespaces" target="_blank" rel="noopener noreferrer" class="">Vault Namespaces</a></li>
<li class=""><a href="https://github.com/input-output-hk/atala-prism-building-blocks/blob/main/docs/decisions/20230516-hierarchical-deterministic-key-generation-algorithm.md" target="_blank" rel="noopener noreferrer" class="">HD Key Derivation ADR</a></li>
<li class=""><a href="https://www.vaultproject.io/docs/auth/approle" target="_blank" rel="noopener noreferrer" class="">Vault AppRole Authentication</a></li>
<li class=""><a href="https://www.vaultproject.io/docs/auth/token" target="_blank" rel="noopener noreferrer" class="">Vault Token Authentication</a></li>
<li class=""><a href="https://www.vaultproject.io/docs/secrets/kv/kv-v2" target="_blank" rel="noopener noreferrer" class="">Vault KV Secrets Engine</a></li>
<li class=""><a href="https://www.vaultproject.io/docs/concepts/entities" target="_blank" rel="noopener noreferrer" class="">Vault Entities</a></li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#terminology" class="table-of-contents__link toc-highlight">Terminology</a><ul><li><a href="#vault" class="table-of-contents__link toc-highlight">Vault</a></li><li><a href="#agent" class="table-of-contents__link toc-highlight">Agent</a></li><li><a href="#wallet" class="table-of-contents__link toc-highlight">Wallet</a></li></ul></li><li><a href="#technical-overview" class="table-of-contents__link toc-highlight">Technical Overview</a><ul><li><a href="#the-cloud-agent-logical-isolation" class="table-of-contents__link toc-highlight">The Cloud Agent Logical Isolation</a></li><li><a href="#the-cloud-agent-authentication" class="table-of-contents__link toc-highlight">The Cloud Agent Authentication</a></li><li><a href="#wallet-authentication" class="table-of-contents__link toc-highlight">Wallet Authentication</a></li><li><a href="#secrets-engine-configuration" class="table-of-contents__link toc-highlight">Secrets Engine Configuration</a></li><li><a href="#single-and-multi-tenant-configuration" class="table-of-contents__link toc-highlight">Single and Multi-Tenant Configuration</a></li><li><a href="#key-derivation" class="table-of-contents__link toc-highlight">Key Derivation</a></li><li><a href="#naming-convention" class="table-of-contents__link toc-highlight">Naming Convention</a></li></ul></li></ul></div></div></div></div></main></div></div></div><div class="container"><footer class="footer_J6tW"><svg xmlns="http://www.w3.org/2000/svg" width="145" height="38" fill="none"></svg><span class="copyright_C6JK">Hyperledger Identus CC BY 4.0</span></footer></div></div>
</body>
</html>