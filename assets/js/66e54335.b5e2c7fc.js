"use strict";(self.webpackChunkidentus_documentation_portal=self.webpackChunkidentus_documentation_portal||[]).push([[2581],{14725:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>d});var t=i(74848),o=i(28453);const c={},s="Connections",a={id:"connections/connection",title:"Connections",description:"A connection is a stateful relationship between two parties that enables secure communication.",source:"@site/identus-cloud-agent/docs/docusaurus/connections/connection.md",sourceDirName:"connections",slug:"/connections/connection",permalink:"/identus-docs/tutorials/connections/connection",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialsSidebar",previous:{title:"Tutorials",permalink:"/identus-docs/tutorials/"},next:{title:"Credentials",permalink:"/identus-docs/tutorials/category/credentials"}},r={},d=[{value:"Roles",id:"roles",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Cloud Agent endpoints overview",id:"cloud-agent-endpoints-overview",level:2},{value:"Inviter Flow",id:"inviter-flow",level:2},{value:"Invitee Flow",id:"invitee-flow",level:2},{value:"Sequence diagram",id:"sequence-diagram",level:2},{value:"Command line example",id:"command-line-example",level:2},{value:"Inviter creates an invitation",id:"inviter-creates-an-invitation",level:3},{value:"<strong>Invitee</strong> accepts OOB invitation",id:"invitee-accepts-oob-invitation",level:3},{value:"Invitee retrieves the list of connections",id:"invitee-retrieves-the-list-of-connections",level:3},{value:"Inviter retrieves the list of connections",id:"inviter-retrieves-the-list-of-connections",level:3}];function l(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"connections",children:"Connections"})}),"\n",(0,t.jsx)(e.p,{children:"A connection is a stateful relationship between two parties that enables secure communication."}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.a,{href:"/docs/concepts/glossary#connection-protocol",children:"Connection protocol"})," is required to establish secure connections between agents,\nallowing them to exchange information and interact."]}),"\n",(0,t.jsx)(e.h2,{id:"roles",children:"Roles"}),"\n",(0,t.jsx)(e.p,{children:"The connection protocol has two roles:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/docs/concepts/glossary#inviter",children:"Inviter"}),": A subject that initiates a connection request by sending a ",(0,t.jsx)(e.a,{href:"/docs/concepts/glossary#connection-invitation",children:"connection invitation"}),"."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/docs/concepts/glossary#invitee",children:"Invitee"}),": A subject that receives a connection invitation and accepts it by sending a ",(0,t.jsx)(e.a,{href:"/docs/concepts/glossary#connection-request",children:"connection request"}),"."]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Inviter and Invitee Cloud Agents up and running"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"cloud-agent-endpoints-overview",children:"Cloud Agent endpoints overview"}),"\n",(0,t.jsx)(e.p,{children:"The protocol uses the following REST API endpoints:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/agent-api/#tag/Connections-Management",children:(0,t.jsx)(e.code,{children:"/connections"})}),":","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/agent-api/#tag/Connections-Management/operation/createConnection",children:(0,t.jsx)(e.code,{children:"POST"})}),": Creates a new connection and returns an invitation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/agent-api/#tag/Connections-Management/operation/getConnections",children:(0,t.jsx)(e.code,{children:"GET"})}),": Returns a list of connections"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/agent-api/#tag/Connections-Management/operation/getConnection",children:(0,t.jsx)(e.code,{children:"GET /connections/{connectionId}"})}),": Returns an existing connection record by id"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/agent-api/#tag/Connections-Management/operation/acceptConnectionInvitation",children:(0,t.jsx)(e.code,{children:"POST /connection-invitations"})}),": Accepts an externally received invitation"]}),"\n"]}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsxs)(e.p,{children:["Please check the full ",(0,t.jsx)(e.a,{href:"/agent-api",children:"Cloud Agent API"})," specification for more detailed information."]})}),"\n",(0,t.jsx)(e.h2,{id:"inviter-flow",children:"Inviter Flow"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["Generate and share a new Out-of-Band (OOB) invitation (connection gets created in ",(0,t.jsx)(e.code,{children:"InvitationGenerated"})," state)"]}),"\n",(0,t.jsxs)(e.li,{children:["Receive a connection request from the Invitee (connection moves to ",(0,t.jsx)(e.code,{children:"ConnectionRequestReceived"})," state)"]}),"\n",(0,t.jsxs)(e.li,{children:["Accept the connection request (connection moves to ",(0,t.jsx)(e.code,{children:"ConnectionResponsePending"})," state)"]}),"\n",(0,t.jsxs)(e.li,{children:["Send the connection response via the DIDComm Agent (connection achieves ",(0,t.jsx)(e.code,{children:"ConnectionResponseSent"})," state)"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"The following diagram represents the Inviter's Connection state transitions:"}),"\n",(0,t.jsx)(e.mermaid,{value:"---\ntitle: Inviter Connection State\n---\nstateDiagram-v2\n[*] --\x3e InvitationGenerated: generate and share new OOB invitation\nInvitationGenerated --\x3e ConnectionRequestReceived: receive connection request\nConnectionRequestReceived --\x3e ConnectionResponsePending: accept connection request\nConnectionResponsePending --\x3e ConnectionResponseSent: send connection response (DIDComm)\nConnectionResponseSent --\x3e [*]"}),"\n",(0,t.jsx)(e.h2,{id:"invitee-flow",children:"Invitee Flow"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["Receive the OOB invitation (",(0,t.jsx)(e.code,{children:"InvitationReceived"})," state)"]}),"\n",(0,t.jsxs)(e.li,{children:["Accept the invitation (connection is created in ",(0,t.jsx)(e.code,{children:"ConnectionRequestPending"})," state)"]}),"\n",(0,t.jsxs)(e.li,{children:["Send the connection request via ",(0,t.jsx)(e.a,{href:"/docs/concepts/glossary#didcomm",children:"DIDComm"})," (connection achieves ",(0,t.jsx)(e.code,{children:"ConnectionRequestSent"})," state)"]}),"\n",(0,t.jsxs)(e.li,{children:["Receive the connection response (connection achieves ",(0,t.jsx)(e.code,{children:"ConnectionResponseReceived"})," state)"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"The following diagram represents the Invitee's Connection state transitions:"}),"\n",(0,t.jsx)(e.mermaid,{value:"---\ntitle: Invitee Connection State\n---\nstateDiagram-v2\n[*] --\x3e InvitationReceived: receive OOB invitation\nInvitationReceived --\x3e ConnectionRequestPending: accept invitation\nConnectionRequestPending --\x3e ConnectionRequestSent: send connection request (DIDComm)\nConnectionRequestSent --\x3e ConnectionResponseReceived: receive connection response\nConnectionResponseReceived --\x3e [*]"}),"\n",(0,t.jsx)(e.h2,{id:"sequence-diagram",children:"Sequence diagram"}),"\n",(0,t.jsx)(e.p,{children:"The following diagram shows the end-to-end flow for establishing a connection between an inviter and an invitee."}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:i(83729).A+"",width:"1333",height:"1462"})}),"\n",(0,t.jsx)(e.h2,{id:"command-line-example",children:"Command line example"}),"\n",(0,t.jsx)(e.p,{children:"The following example demonstrates how you could use two Cloud Agent APIs to set up a connection between them."}),"\n",(0,t.jsx)(e.h3,{id:"inviter-creates-an-invitation",children:"Inviter creates an invitation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-shell",children:"curl -X 'POST' \\\n 'http://localhost:8080/cloud-agent/connections' \\\n -H 'Content-Type: application/json' \\\n -H \"apikey: $API_KEY\" \\\n -d '{ \"label\": \"Connect with Alice\" }' | jq\n"})}),"\n",(0,t.jsx)(e.p,{children:"Example response:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "connectionId": "1893e207-4cba-4792-8179-067c78d2acc2",\n  "createdAt": "2023-02-02T17:14:13.593647Z",\n  "invitation": {\n    "from": "did:peer:inviter-did",\n    "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n    "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n    "type": "https://didcomm.org/out-of-band/2.0/invitation"\n  },\n  "kind": "/connections/1893e207-4cba-4792-8179-067c78d2acc2",\n  "label": "Connect with Alice",\n  "self": "Connection",\n  "state": "InvitationGenerated"\n}\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"invitee-accepts-oob-invitation",children:[(0,t.jsx)(e.strong,{children:"Invitee"})," accepts OOB invitation"]}),"\n",(0,t.jsxs)(e.p,{children:["Replace ",(0,t.jsx)(e.code,{children:"{RAW_INVITATION}"})," with the value of the '_oob' query string parameter from the invitation URL above"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-shell",children:"curl -X 'POST' \\\n 'http://localhost:8090/cloud-agent/connection-invitations' \\\n -H 'Content-Type: application/json' \\\n -H \"apikey: $API_KEY\" \\\n -d '{ \"invitation\": \"{RAW_INVITATION}\" }' | jq\n"})}),"\n",(0,t.jsx)(e.p,{children:"Example response:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "connectionId": "755a457a-878e-4292-a3f2-cb83601f802e",\n  "createdAt": "2023-02-02T18:05:58Z",\n  "invitation": {\n    "from": "did:peer:inviter-did",\n    "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n    "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n    "type": "https://didcomm.org/out-of-band/2.0/invitation"\n  },\n  "kind": "/connections/755a457a-878e-4292-a3f2-cb83601f802e",\n  "myDid": "did:peer:invitee-did",\n  "self": "Connection",\n  "state": "ConnectionRequestPending",\n  "theirDid": "did:peer:inviter-did",\n  "updatedAt": "2023-02-02T18:05:59Z"\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"invitee-retrieves-the-list-of-connections",children:"Invitee retrieves the list of connections"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-shell",children:"curl -X 'GET' 'http://localhost:8090/cloud-agent/connections' \\\n    -H \"apikey: $API_KEY\" | jq\n"})}),"\n",(0,t.jsx)(e.p,{children:"Example output:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "contents": [\n    {\n      "connectionId": "755a457a-878e-4292-a3f2-cb83601f802e",\n      "createdAt": "2023-02-02T18:05:58Z",\n      "invitation": {\n        "from": "did:peer:issuer-did",\n        "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n        "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n        "type": "https://didcomm.org/out-of-band/2.0/invitation"\n      },\n      "kind": "/connections/755a457a-878e-4292-a3f2-cb83601f802e",\n      "myDid": "did:peer:holder-did",\n      "self": "Connection",\n      "state": "ConnectionResponseReceived",\n      "theirDid": "did:peer:issuer-did",\n      "updatedAt": "2023-02-02T18:06:14Z"\n    }\n  ],\n  "kind": "Collection",\n  "self": "/collections"\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"inviter-retrieves-the-list-of-connections",children:"Inviter retrieves the list of connections"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-shell",children:"curl -X 'GET' 'http://localhost:8080/cloud-agent/connections' \\\n    -H \"apikey: $API_KEY\" | jq\n"})}),"\n",(0,t.jsx)(e.p,{children:"Example response:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "contents": [\n    {\n      "connectionId": "1893e207-4cba-4792-8179-067c78d2acc2",\n      "createdAt": "2023-02-02T17:14:13Z",\n      "invitation": {\n        "from": "did:peer:issuer-did",\n        "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n        "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n        "type": "https://didcomm.org/out-of-band/2.0/invitation"\n      },\n      "kind": "/connections/1893e207-4cba-4792-8179-067c78d2acc2",\n      "label": "Connect with Alice",\n      "myDid": "did:peer:issuer-did",\n      "self": "Connection",\n      "state": "ConnectionResponseSent",\n      "theirDid": "did:peer:holder-did",\n      "updatedAt": "2023-02-02T18:06:16Z"\n    }\n  ],\n  "kind": "Collection",\n  "self": "/collections"\n}\n'})}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsxs)(e.p,{children:["Please check the full ",(0,t.jsx)(e.a,{href:"/agent-api",children:"Cloud Agent API"})," specification for more detailed information."]})})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(l,{...n})}):l(n)}},83729:(n,e,i)=>{i.d(e,{A:()=>t});const t=i.p+"assets/images/connection-flow-1c40a0f648b72caed0223ec70bdba546.png"},28453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>a});var t=i(96540);const o={},c=t.createContext(o);function s(n){const e=t.useContext(c);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),t.createElement(c.Provider,{value:e},n.children)}}}]);