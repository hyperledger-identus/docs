"use strict";(self.webpackChunkidentus_documentation_portal=self.webpackChunkidentus_documentation_portal||[]).push([[3959],{77962:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var t=n(74848),i=n(28453);const a={},o="Mediator message storage",r={id:"decisions/2023-05-15-mediator-message-storage",title:"Mediator message storage",description:"- Status: accepted",source:"@site/documentation/adrs/decisions/2023-05-15-mediator-message-storage.md",sourceDirName:"decisions",slug:"/decisions/2023-05-15-mediator-message-storage",permalink:"/identus-docs/adrs/decisions/2023-05-15-mediator-message-storage",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"adrsSidebar",previous:{title:"Routing Requests to the Correct Tenant",permalink:"/identus-docs/adrs/decisions/2023-05-09-message-routing-for-multi-tenant"},next:{title:"Hierarchical deterministic key generation algorithm",permalink:"/identus-docs/adrs/decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm"}},d={},l=[{value:"Context and Problem Statement",id:"context-and-problem-statement",level:2},{value:"Decision Drivers",id:"decision-drivers",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Positive Consequences",id:"positive-consequences",level:3},{value:"Negative Consequences",id:"negative-consequences",level:3},{value:"Pros and Cons of the Options",id:"pros-and-cons-of-the-options",level:2},{value:"MongoDB",id:"mongodb",level:3},{value:"Refrences used",id:"refrences-used",level:2}];function c(e){const s={a:"a",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"mediator-message-storage",children:"Mediator message storage"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Status: accepted"}),"\n",(0,t.jsx)(s.li,{children:"Deciders: Yurii Shynbuiev, Benjamin Voiturier, Shailesh Patil, Fabio Pinheiro , David Poltorak"}),"\n",(0,t.jsx)(s.li,{children:"Date: [2023-05-09]"}),"\n",(0,t.jsx)(s.li,{children:"Tags: storage, db, message, mongo, postgres, sql"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"context-and-problem-statement",children:"Context and Problem Statement"}),"\n",(0,t.jsx)(s.p,{children:"Mediator storage\nRelational databases like PostgreSQL store data in structured tables, with rows and columns that help establish relationships between various tables and entities.\nSQL is used in PostgreSQL to save, retrieve, access, and manipulate the database data.\nWhile PostgreSQL may be ideal for managing structured data streams, it tends to struggle when dealing with big unstructured data, as maintaining such relations can increase time complexity significantly.\nPostgres SQL relies on relational data models that need to defined in advance\nChange in any field in table requires lengthy process of migration scripts run and to maintain but it works there are tools available and we also use it PrismAgent,\nBut maintenance cost of software is higher."}),"\n",(0,t.jsx)(s.p,{children:"Contrastingly, non-relational databases like MongoDB excel in these scenarios because data isn't constrained to a single table.\nThis approach permits massive data streams to be imported directly into the system without the burden of setting up increasingly complex relationships and keys.\nMongoDB typically stores data within documents using JSON (JavaScript Object Notation) or BSON (Binary JavaScript Object Notation), which simplifies the handling of big data and complex data streams.\ndocument database supports a rapid, iterative cycle of development the way that a document database turns data into code.\nMongoDB is faster at inserting and for queries that use nested references instead of joins\nIn Mediator the data which we send or receive is json message and to process json message we can avoid the unnecessary serialization and deserialization by having it stored in document database.\nPostgres SQL by default in vertically scalable where as Mongo can scale horizontally, This can help in scalability problem\nMediator messages store in simple and straight forward write there is no transactional workflow involved so we don't gain much by using relational db like postgres."}),"\n",(0,t.jsxs)(s.p,{children:["Below are the 2 options which we can use to reduce infrastructure management\nMongoDB Atlas. Fully managed MongoDB in the cloud which can reduce the infrastructure management [",(0,t.jsx)(s.a,{href:"https://www.mongodb.com/atlas/database",children:"https://www.mongodb.com/atlas/database"}),"]","\nAmazon DocumentDB (with MongoDB compatibility)  [",(0,t.jsx)(s.a,{href:"https://aws.amazon.com/documentdb/",children:"https://aws.amazon.com/documentdb/"}),"]"]}),"\n",(0,t.jsx)(s.h2,{id:"decision-drivers",children:"Decision Drivers"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"DIDCOMM messages are json based"}),"\n",(0,t.jsx)(s.li,{children:"flexibility to store the data"}),"\n",(0,t.jsx)(s.li,{children:"Reduce serialisation deserilisation of the data"}),"\n",(0,t.jsx)(s.li,{children:"Easy to write the json queries"}),"\n",(0,t.jsx)(s.li,{children:"scalability"}),"\n",(0,t.jsx)(s.li,{children:"low maintainance"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"considered-options",children:"Considered Options"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"PostgresSQL (Storing unstructured data (JSON) and quering data (JSON), scalability)"}),"\n",(0,t.jsx)(s.li,{children:"MongoDB (Storing unstructured data (JSON) and quering data (JSON), scalability)"}),"\n",(0,t.jsx)(s.li,{children:"Kafka Stream (Storing unstructured data (JSON) and quering data (JSON), scalability and streaming)"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"decision-outcome",children:"Decision Outcome"}),"\n",(0,t.jsxs)(s.p,{children:["Chosen option: MongoDB because of storing unstructured json data and json queries that requires minimal changes to the existing code and provides the benefits for the current use cases.\nIs a NoSQL database that uses a document-oriented data model. Data is stored in a semi-structured format (BSON, similar to JSON), which can easily accommodate changes in data structure. This makes MongoDB particularly suitable for large volumes of data that may not be easily modeled in a relational schema.\nKafka Stream was also considered but current usecases are more towards storage of the messages, streaming is not the usecase for all the scenarios and the  mediator pickup protocol ([",(0,t.jsx)(s.a,{href:"https://didcomm.org/pickup/3.0/",children:"https://didcomm.org/pickup/3.0/"}),"])"," requirements need the flexibily to delete the messages read."]}),"\n",(0,t.jsx)(s.h3,{id:"positive-consequences",children:"Positive Consequences"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"flexility to store unstructured data in json format"}),"\n",(0,t.jsx)(s.li,{children:"easy work with storage of unstrutured data and json queries"}),"\n",(0,t.jsx)(s.li,{children:"low cost for with no sql migrations required."}),"\n",(0,t.jsx)(s.li,{children:"Uses a flexible, JSON-like query language. While this provides great flexibility"}),"\n",(0,t.jsx)(s.li,{children:"Is designed for easy horizontal scalability, which is achieved through sharding."}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"negative-consequences",children:"Negative Consequences"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Extra infrastructure and additional resource to be maintained"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"pros-and-cons-of-the-options",children:"Pros and Cons of the Options"}),"\n",(0,t.jsx)(s.h3,{id:"mongodb",children:"MongoDB"}),"\n",(0,t.jsx)(s.p,{children:"MongoDB provides flexibility with json storage and queries"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Good, because it is horizontally scalable"}),"\n",(0,t.jsx)(s.li,{children:"Good, because typically performs better with large, unstructured datasets and write-heavy applications"}),"\n",(0,t.jsx)(s.li,{children:"Good, because have strong communities and extensive support materials, so you can expect to find help when you encounter issues."}),"\n",(0,t.jsx)(s.li,{children:"Bad, Is not full ACID compliance"}),"\n",(0,t.jsx)(s.li,{children:"Bad, Doesn't natively support complex joins like a relational database"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"refrences-used",children:"Refrences used"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["[",(0,t.jsx)(s.a,{href:"https://www.plesk.com/blog/various/mongodb-vs-postgresql/",children:"https://www.plesk.com/blog/various/mongodb-vs-postgresql/"}),"]"]}),"\n",(0,t.jsxs)(s.li,{children:["[",(0,t.jsx)(s.a,{href:"https://www.dbvis.com/thetable/json-vs-jsonb-in-postgresql-a-complete-comparison/",children:"https://www.dbvis.com/thetable/json-vs-jsonb-in-postgresql-a-complete-comparison/"}),"]"]}),"\n",(0,t.jsxs)(s.li,{children:["[",(0,t.jsx)(s.a,{href:"https://severalnines.com/blog/overview-json-capabilities-within-postgresql/",children:"https://severalnines.com/blog/overview-json-capabilities-within-postgresql/"}),"]"]}),"\n",(0,t.jsxs)(s.li,{children:["[",(0,t.jsx)(s.a,{href:"https://www.mongodb.com/docs/manual/core/schema-validation/",children:"https://www.mongodb.com/docs/manual/core/schema-validation/"}),"]"]}),"\n",(0,t.jsxs)(s.li,{children:["[",(0,t.jsx)(s.a,{href:"https://www.mongodb.com/compare/mongodb-dynamodb",children:"https://www.mongodb.com/compare/mongodb-dynamodb"}),"]"]}),"\n",(0,t.jsxs)(s.li,{children:["[",(0,t.jsx)(s.a,{href:"https://www.projectpro.io/article/dynamodb-vs-mongodb/826",children:"https://www.projectpro.io/article/dynamodb-vs-mongodb/826"}),"]"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>r});var t=n(96540);const i={},a=t.createContext(i);function o(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);