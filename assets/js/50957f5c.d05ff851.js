"use strict";(self.webpackChunkidentus_documentation_portal=self.webpackChunkidentus_documentation_portal||[]).push([[2633],{98830:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var s=n(74848),t=n(28453);const r={},o="DID-linked-resources",c={id:"decisions/did-linked-resources",title:"DID-linked-resources",description:"- Status: draft",source:"@site/documentation/adrs/decisions/20230405-did-linked-resources.md",sourceDirName:"decisions",slug:"/decisions/did-linked-resources",permalink:"/identus-docs/adrs/decisions/did-linked-resources",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:20230405,frontMatter:{},sidebar:"tutorialsSidebar",previous:{title:"Data isolation for multi-tenancy",permalink:"/identus-docs/adrs/decisions/data-isolation-for-multitenancy"},next:{title:"Handle errors in background jobs by storing on state records and sending via webhooks",permalink:"/identus-docs/adrs/decisions/handle-errors-in-bg-jobs-by-storing-on-state-records-and-sending-via-webhooks"}},d={},a=[{value:"Target",id:"target",level:2},{value:"Context and Problem Statement",id:"context-and-problem-statement",level:2},{value:"Constraints",id:"constraints",level:2},{value:"Storage limitations",id:"storage-limitations",level:3},{value:"Scalability",id:"scalability",level:3},{value:"Access control",id:"access-control",level:3},{value:"Data privacy",id:"data-privacy",level:3},{value:"Decision Drivers",id:"decision-drivers",level:2},{value:"Storage",id:"storage",level:2},{value:"Linking the resource to the DID",id:"linking-the-resource-to-the-did",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"DID document linkedResources field",id:"did-document-linkedresources-field",level:3},{value:"Positive Consequences",id:"positive-consequences",level:4},{value:"Negative Consequences",id:"negative-consequences",level:4},{value:"Out of the Scope",id:"out-of-the-scope",level:4},{value:"DID document didDocumentMetadata -&gt; linkedResourceMetadata (Cheqd ADR)",id:"did-document-diddocumentmetadata---linkedresourcemetadata-cheqd-adr",level:3},{value:"Positive Consequences",id:"positive-consequences-1",level:4},{value:"Negative Consequences",id:"negative-consequences-1",level:4},{value:"DID URL dereferencing (W3C specification)",id:"did-url-dereferencing-w3c-specification",level:3},{value:"Positive Consequences",id:"positive-consequences-2",level:4},{value:"Negative Consequences",id:"negative-consequences-2",level:4},{value:"Out of the Scope",id:"out-of-the-scope-1",level:4},{value:"DID URL Dereferencing (Trust over IP specification - outdated)",id:"did-url-dereferencing-trust-over-ip-specification---outdated",level:3},{value:"DID URL Dereferencing (Trust over IP specification - latest)",id:"did-url-dereferencing-trust-over-ip-specification---latest",level:3},{value:"Positive Consequences",id:"positive-consequences-3",level:4},{value:"Negative Consequences",id:"negative-consequences-3",level:4},{value:"Out of the Scope",id:"out-of-the-scope-2",level:4},{value:"RootsID - Cardano AnonCreds (Implementation of ToIP at the Cardano stack)",id:"rootsid---cardano-anoncreds-implementation-of-toip-at-the-cardano-stack",level:3},{value:"Positive Consequences",id:"positive-consequences-4",level:4},{value:"Negative Consequences",id:"negative-consequences-4",level:4},{value:"Hyperledger AnonCreds",id:"hyperledger-anoncreds",level:3},{value:"Positive Consequences",id:"positive-consequences-5",level:4},{value:"Negative Consequences",id:"negative-consequences-5",level:4},{value:"Trinsic Solution",id:"trinsic-solution",level:3},{value:"Positive &amp; Negative Consequences",id:"positive--negative-consequences",level:4},{value:"Solution #1 (W3C with dynamic resource resolution)",id:"solution-1-w3c-with-dynamic-resource-resolution",level:3},{value:"Positive Consequences",id:"positive-consequences-6",level:4},{value:"Negative Consequences",id:"negative-consequences-6",level:4},{value:"Solution #2 (ToIP specification implementation)",id:"solution-2-toip-specification-implementation",level:3},{value:"Positive Consequences",id:"positive-consequences-7",level:4},{value:"Negative Consequences",id:"negative-consequences-7",level:4},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Links",id:"links",level:2}];function l(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h1,{id:"did-linked-resources",children:"DID-linked-resources"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Status: draft"}),"\n",(0,s.jsx)(i.li,{children:"Deciders: Yurii Shynbuiev, Benjamin Voiturier, Lohan Spies, Ezequiel Postan, Shota Jolbordi"}),"\n",(0,s.jsx)(i.li,{children:"Date: 2023-04-05"}),"\n",(0,s.jsx)(i.li,{children:"Tags: did, linked-data, ledger"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"target",children:"Target"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.a,{href:"https://input-output.atlassian.net/browse/ATL-3186",children:"Research Spike - Schema and Verifiable Presentation Registry"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Provide a clear and concise analysis of the various schema registry implementation and the associated benefits and downfalls of each approach."}),"\n",(0,s.jsx)(i.li,{children:"Provide a concrete proposal for what we would like to implement for the Identus platform."}),"\n",(0,s.jsx)(i.li,{children:"Provide a generic way of storing and linking the resources for the DID in the Identus platform."}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"context-and-problem-statement",children:"Context and Problem Statement"}),"\n",(0,s.jsx)(i.p,{children:"Identus platform must be able to store and distribute the various resources such as credential schemas, logos, revocation status lists, and documents (aka any text, JSON, images, etc). But in the scope of the current ADR the following resource types are discussed:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"credential schema (JSON and AnonCreds)"}),"\n",(0,s.jsx)(i.li,{children:"credential definition (AnonCreds)"}),"\n",(0,s.jsx)(i.li,{children:"revocation list"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"NOTE"}),": Resources containing the PII must never be stored on-chain."]}),"\n",(0,s.jsx)(i.p,{children:"Requirements for storing and distributing resources:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Decentralization - resources must be stored in decentralized storage"}),"\n",(0,s.jsx)(i.li,{children:"Discoverability - it should be possible to discover the resource"}),"\n",(0,s.jsx)(i.li,{children:"Longevity - the ability of a storage solution to maintain the availability and integrity of stored resources"}),"\n",(0,s.jsx)(i.li,{children:"Interoperability - it should be possible for other SSI systems to fetch the resource"}),"\n",(0,s.jsx)(i.li,{children:"Trust - resources must be stored in reliable tamper-proof storage and be trusted by other SSI systems"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["Other requirements, such as ",(0,s.jsx)(i.code,{children:"versioning"}),", ",(0,s.jsx)(i.code,{children:"security"})," and ",(0,s.jsx)(i.code,{children:"immutability"})," are out of the scope of this ADR:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Versioning - is a specific requirement for the particular resource and belongs to the resource metadata"}),"\n",(0,s.jsx)(i.li,{children:"Security - is an important aspect that must be taken into account by the underlying storage system and data access layer"}),"\n",(0,s.jsxs)(i.li,{children:["Immutability - is one of the strategies to guarantee ",(0,s.jsx)(i.code,{children:"trust"})," and `decentralisation``, but it shouldn't be a requirement by itself."]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"The technical solution contains a lot of variations and particular small decisions but overall it can be split into two main questions:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"where the resource is stored?"}),"\n",(0,s.jsx)(i.li,{children:"how the resource is discovered and fetched?"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"constraints",children:"Constraints"}),"\n",(0,s.jsx)(i.h3,{id:"storage-limitations",children:"Storage limitations"}),"\n",(0,s.jsx)(i.p,{children:"All decentralized storage (DLT or IPFS) has storage limitations, and the amount of data that can be stored is limited by the available storage capacity and the way how the resources are stored."}),"\n",(0,s.jsx)(i.p,{children:"The following aspect must be taken into account for storing the resources in DLT:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"transaction size limit (can be mitigated by data fragmentation, so the single resource is stored in multiple transactions) - 16KB, 32KB, 64KB, up to 1MB - depending on the type of the blockchain"}),"\n",(0,s.jsx)(i.li,{children:"throughput - bytes we can insert to storage per unit of time"}),"\n",(0,s.jsx)(i.li,{children:"latency - multi-second time per insert"}),"\n",(0,s.jsx)(i.li,{children:"cost - each insertion costs fees"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Based on the nature of the resource the size limitations must be considered."}),"\n",(0,s.jsx)(i.p,{children:"For the following resource types and the common use cases 16KB should be enough, so it's possible to store these on DLT:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"credential schema"}),"\n",(0,s.jsx)(i.li,{children:"credential definition"}),"\n",(0,s.jsx)(i.li,{children:"logo in SVG format"}),"\n",(0,s.jsx)(i.li,{children:"Merkle Tree"}),"\n",(0,s.jsx)(i.li,{children:"documentation in the markdown format"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"For larger resource types IPFS or another option should be considered. Large resource examples:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"media files"}),"\n",(0,s.jsx)(i.li,{children:"large documents"}),"\n",(0,s.jsx)(i.li,{children:"large revocation status lists"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["IPFS doesn't have a size limitation (it's limited by the underlying storage or the particular SDK) and requires additional infrastructure and ",(0,s.jsx)(i.code,{children:"incentives"})," (the way to pay for the storage) from the community."]}),"\n",(0,s.jsx)(i.p,{children:"IPFS can be used for storing the resources, but it should be covered in the scope of separated ADR."}),"\n",(0,s.jsx)(i.h3,{id:"scalability",children:"Scalability"}),"\n",(0,s.jsx)(i.p,{children:"While DLT and IPFS are designed for scalability, they can still face issues with scalability when it comes to storing SSI resources. As more users store their SSI resources on these platforms, it can become more difficult to scale the infrastructure to handle the increased demand."}),"\n",(0,s.jsxs)(i.p,{children:["To mitigate the scalability challenge the ",(0,s.jsx)(i.code,{children:"hybrid"})," solution can be considered. In this case, the resource is stored in the centralized database or IPFS system, and the ",(0,s.jsx)(i.code,{children:"hash"}),", ",(0,s.jsx)(i.code,{children:"signature"})," or other metadata that guarantees the ",(0,s.jsx)(i.code,{children:"trust"})," is stored on-chain."]}),"\n",(0,s.jsx)(i.p,{children:"Storing credential schemas, and logos, not large documents don't require the hybrid solution, so the use cases for it is out of scope in the current ADR."}),"\n",(0,s.jsx)(i.p,{children:"Scalability issues also must be considered in the decision for linking the resources to the DID. For instance, the Cheqd solution keeps all the resources linked to the DID inside of the metadata of the DIDDoc which leads to growing the DIDDoc size after some period and an update of the DID Document when the new resource is published on-chain and linked to the DID."}),"\n",(0,s.jsx)(i.h3,{id:"access-control",children:"Access control"}),"\n",(0,s.jsx)(i.p,{children:"SSI resources stored in DLT and IPFS can be accessed by anyone who has access to the network."}),"\n",(0,s.jsx)(i.p,{children:"This can be a security concern for organizations that need to control access to their SSI resources."}),"\n",(0,s.jsx)(i.p,{children:"Access control also can be an issue for interoperability with other SSI systems."}),"\n",(0,s.jsx)(i.p,{children:"The types of resources such as credential schemas, logos, and revocation lists should be available without additional access control."}),"\n",(0,s.jsx)(i.h3,{id:"data-privacy",children:"Data privacy"}),"\n",(0,s.jsx)(i.p,{children:"While DLT and IPFS are designed to be secure, there is still a risk that SSI resources stored on these platforms could be accessed or stolen by unauthorized parties."}),"\n",(0,s.jsx)(i.p,{children:"This is especially concerning when it comes to sensitive personal information."}),"\n",(0,s.jsx)(i.p,{children:"Personal data or any other sensitive information should not be stored on-chain and be available for unauthorized parties."}),"\n",(0,s.jsx)(i.p,{children:"Credential schemas, documents, and logos usually do not contain personal data, so can be stored on-chain."}),"\n",(0,s.jsx)(i.p,{children:"Revocation lists that are designed using privacy-preserving capabilities can be stored on-chain as well."}),"\n",(0,s.jsx)(i.h2,{id:"decision-drivers",children:"Decision Drivers"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Interoperability"}),"\n",(0,s.jsx)(i.li,{children:"Trust"}),"\n",(0,s.jsx)(i.li,{children:"Longevity"}),"\n",(0,s.jsx)(i.li,{children:"Scalability"}),"\n",(0,s.jsx)(i.li,{children:"Discoverability"}),"\n",(0,s.jsx)(i.li,{children:"Vendor Lock"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"storage",children:"Storage"}),"\n",(0,s.jsx)(i.p,{children:"Choosing the right storage for resources is an architectural decision."}),"\n",(0,s.jsx)(i.p,{children:"Companies that build SSI platforms usually use the underlying blockchain for storing the resources in a generic way and an API layer with an underlying centralized database and SDK for indexing, and access to the resources."}),"\n",(0,s.jsx)(i.p,{children:"Usually, resources are stored efficiently (any binary format, protobuf, CBOR) on-chain to reduce the size and the cost of the operation."}),"\n",(0,s.jsx)(i.p,{children:"The application layer that communicates with the underlying blockchain is used for publishing and retrieval of the resource.\nBased on concrete implementation, the resources can be decoded and indexed in the database and available via internal API, SDI, or Universal Resolver."}),"\n",(0,s.jsxs)(i.p,{children:["Storing resources off-chain also makes sense, but in this case, the ",(0,s.jsx)(i.code,{children:"longevity"})," of the storage and an API layer is limited by the lifetime of the organization that published the resource. For this solution, ",(0,s.jsx)(i.code,{children:"trust"})," can be achieved by signing the resource using the key of the DID stored on-chain. This solution is not fully centralized as the organizations have their infrastructure with the database."]}),"\n",(0,s.jsx)(i.h2,{id:"linking-the-resource-to-the-did",children:"Linking the resource to the DID"}),"\n",(0,s.jsx)(i.p,{children:"Linking a resource to a DID means associating a specific resource with a DID and resolving the resource via the Universal Resolver or application API or SDK or finding it on-chain."}),"\n",(0,s.jsx)(i.p,{children:"In all the considered solutions this is achieved using a DID document and the algorithm for discovery and resource dereferencing."}),"\n",(0,s.jsx)(i.h2,{id:"considered-options",children:"Considered Options"}),"\n",(0,s.jsx)(i.h3,{id:"did-document-linkedresources-field",children:"DID document linkedResources field"}),"\n",(0,s.jsxs)(i.p,{children:["The particular resource must be available via URL and the metadata of the resource are described in the ",(0,s.jsx)(i.code,{children:"linkedResources"})," array."]}),"\n",(0,s.jsx)(i.p,{children:"Example:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{\n  "@context": "https://w3id.org/did/v1",\n  "id": "did:example:123456789abcdefghi",\n  "publicKey": [{\n    "id": "did:example:123456789abcdefghi#keys-1",\n    "type": "Ed25519VerificationKey2018",\n    "controller": "did:example:123456789abcdefghi",\n    "publicKeyBase58": "7dNN1A8H4DwPU1h4btvohGadnbx8sHF2U6XJU6vLBBfA"\n  }],\n  "linkedResources": [{\n    "url": "https://example.com/credentialschema/123",\n    "type": "CredentialSchema",\n    "name": "DrivingLicense"\n  }]\n}\n'})}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"solution describes the simple way of linking the resources to the DID Document. This approach looks outdated and is not part of the did-core specification."}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences",children:"Negative Consequences"}),"\n",(0,s.jsx)(i.p,{children:"The drawbacks of the solution:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"interoperability: it is not a part of the DID-core specification anymore even if it is possible to find information about it"}),"\n",(0,s.jsx)(i.li,{children:"interoperability: the resource should be fetched by the application or SDK"}),"\n",(0,s.jsx)(i.li,{children:"trust: must be guaranteed by the underlying DLT, the DID document should have an anchor: hash, signature or Tx id that references to the DLT"}),"\n",(0,s.jsx)(i.li,{children:"discoverability: information about the resource's metadata (author, version, content type) is absent"}),"\n",(0,s.jsxs)(i.li,{children:["scalability: DID document must be updated when a new resource is added, so the solution sacrifices ",(0,s.jsx)(i.code,{children:"scalability"})," as the content of the DID document will grow"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"out-of-the-scope",children:"Out of the Scope"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"longevity: should be guaranteed by the underlying DLT"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"did-document-diddocumentmetadata---linkedresourcemetadata-cheqd-adr",children:"DID document didDocumentMetadata -> linkedResourceMetadata (Cheqd ADR)"}),"\n",(0,s.jsxs)(i.p,{children:["Each resource entry is a part of the collection and is described in the ",(0,s.jsx)(i.code,{children:"linkedResourceMetadata"})," field."]}),"\n",(0,s.jsxs)(i.p,{children:["The solution is described in the Cheqd ARD in the ",(0,s.jsx)(i.a,{href:"#links",children:"Links"})," section of the current ADR"]}),"\n",(0,s.jsx)(i.p,{children:"Example:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{\n "didDocumentMetadata": {\n  "linkedResourceMetadata": [\n    {\n      "resourceURI": "did:cheqd:mainnet:1f8e08a2-eeb6-40c3-9e01-33e4a0d1479d/resources/f3d39687-69f5-4046-a960-3aae86a0d3ca",\n      "resourceCollectionId": "1f8e08a2-eeb6-40c3-9e01-33e4a0d1479d",\n      "resourceId": "f3d39687-69f5-4046-a960-3aae86a0d3ca",\n      "resourceName": "PassportSchema", // First version of a Resource called PassportSchema\n      "resourceType": "CL-Schema",\n      "mediaType": "application/json",\n      "created": "2022-07-19T08:40:00Z",\n      "checksum": "7b2022636f6e74656e74223a202274657374206461746122207d0ae3b0c44298",\n      "previousVersionId": null, // null if no previous version, otherwise, resourceId of previous version\n      "nextVersionId": null, // null if no new version, otherwise, resourceId of new version\n    }\n  ]\n }\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"The solution is not fully interoperable with the SSI ecosystem, but it's probably the first successful specification that formalizes the DID-linked resources and the DID URL."}),"\n",(0,s.jsxs)(i.p,{children:["Cheqd's approach for linking the resources to the DID is not a part of the current version of DID specification. Even if it's possible to find some information about ",(0,s.jsx)(i.code,{children:"linkedResources"})," and ",(0,s.jsx)(i.code,{children:"linkedResourceMetadata"})," optional field of the DIDDoc in the cache of the search system or ChatGPT."]}),"\n",(0,s.jsx)(i.p,{children:"Looks like the ToIP specification is inspired by Cheqd's ADR."}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-1",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"versioning of the resource, as metadata contains the references to the previous and next version"}),"\n",(0,s.jsx)(i.li,{children:"collection definition is formalized and published on-chain and in the DID document, so all the resources are categorized"}),"\n",(0,s.jsx)(i.li,{children:"discoverability: URI is replaced with DID URL that allows discovering the resource using Internal and/or Universal resolver"}),"\n",(0,s.jsxs)(i.li,{children:["trust: the ",(0,s.jsx)(i.code,{children:"checksum"})," is provided, so it is possible to verify that the resource was not modified by 3rd party"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-1",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"scalability: the DID document should be updated when the new resource is created"}),"\n",(0,s.jsx)(i.li,{children:"interoperability: using the Universal Resolver is optional, so either SDK or internal application API must be used to fetch the resource"}),"\n",(0,s.jsxs)(i.li,{children:["standard: the ",(0,s.jsx)(i.code,{children:"linkedResourceMetadata"})," field is not a standard part of the DID specification, so the application should be aware of how to deal with it"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"did-url-dereferencing-w3c-specification",children:"DID URL dereferencing (W3C specification)"}),"\n",(0,s.jsxs)(i.p,{children:["The current solution is based on the dereferencing algorithm described in the ",(0,s.jsx)(i.a,{href:"https://w3c-ccg.github.io/did-resolution/#dereferencing",children:"DID-Resolution#dereferencing"})," specification and describes how the DID resolver can dereference the resource linked to the DID. It does not describe where the resource is stored."]}),"\n",(0,s.jsx)(i.p,{children:"The main idea is an algorithm that allows using the DID URL and the information about the services in the DID Document that allows DID Resolver to compose the final resource URL and return the requested resource."}),"\n",(0,s.jsxs)(i.p,{children:["Dereference is performed by defining the service ",(0,s.jsx)(i.code,{children:"id"})," and ",(0,s.jsx)(i.code,{children:"relativeRef"})," params or ",(0,s.jsx)(i.code,{children:"path"})," in the DID URL"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"NOTE:"}),"\nThe ",(0,s.jsx)(i.code,{children:"service.type"})," property is not taken into account in this flow.\nAccording to the did-core specification, the service type and its associated properties SHOULD be registered in the ",(0,s.jsx)(i.a,{href:"https://www.w3.org/TR/did-spec-registries/#service-types",children:"DID Specification Registries"}),".\nSo, defining and registering the ",(0,s.jsx)(i.code,{children:"schemaService"})," or ",(0,s.jsx)(i.code,{children:"resourceService"})," should be the next step to facilitate the interoperability of SSI systems."]}),"\n",(0,s.jsxs)(i.p,{children:["Example 1: using ",(0,s.jsx)(i.code,{children:"service"})," and ",(0,s.jsx)(i.code,{children:"relativeRef"})]}),"\n",(0,s.jsx)(i.p,{children:"The credential schema resource can be defined as a DID URL"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"did:prism:abcdefg?service=credentialschema&relativeRef=%2Fcredentialschemas%2F123e4567-e89b-12d3-a456-426614174000\n"})}),"\n",(0,s.jsx)(i.p,{children:"and the DID Document must have the service defined"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{  \n  "service": [\n    {\n      "id": "did:prism:abcdefg#credentialschema",\n      "type": "CredentialSchema",\n      "serviceEndpoint": "https://agent.example.com/schema-registry"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"so, the Universal Resolver using the concrete DID resolver must dereference the resource as"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"https://agent.example.com/schema-registry/credentialschemas/F123e4567-e89b-12d3-a456-426614174000\n"})}),"\n",(0,s.jsx)(i.p,{children:"and should return the instance of the credential schema"}),"\n",(0,s.jsxs)(i.p,{children:["Example 2: is another variation but using ",(0,s.jsx)(i.code,{children:"service"})," and ",(0,s.jsx)(i.code,{children:"path"})," in the DID URL"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"did:prism:abcdefg/credentialschemas/123e4567-e89b-12d3-a456-426614174000?service=credentialschema\n"})}),"\n",(0,s.jsx)(i.p,{children:"In this case, the DID Method may describe how the path should be resolved and the resource must be fetched."}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-2",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"interoperability: the resource is resolved by the conformant DID resolver according to the specification"}),"\n",(0,s.jsx)(i.li,{children:"discoverability: the resource defined in DID URL is resolved and fetched dynamically"}),"\n",(0,s.jsx)(i.li,{children:"scalability: the DID document is not updated for each new resource"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-2",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["specification: for the particular cases when the ",(0,s.jsx)(i.code,{children:"path"})," is used in the DID URL, the resolution behavior must be described in the DID Method"]}),"\n",(0,s.jsx)(i.li,{children:"scalability: the algorithm contains 2 or 3 steps and the DID Document is always must be resolved in the first step"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"out-of-the-scope-1",children:"Out of the Scope"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"trust, longevity, and technology stack are not specified in this solution"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"did-url-dereferencing-trust-over-ip-specification---outdated",children:"DID URL Dereferencing (Trust over IP specification - outdated)"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.a,{href:"https://wiki.trustoverip.org/display/HOME/DID+URL+Resource+Parameter+Specification",children:"ToIP specification"})," is an analog of the W3C dereferencing specification and describes the convention for dereferencing the resources from the DID URL"]}),"\n",(0,s.jsx)(i.p,{children:"The main idea is the same: use the DID URL and a combination of convention and the DID method to resolve the digital resource associated with the DID."}),"\n",(0,s.jsxs)(i.p,{children:["But instead of relying on the ",(0,s.jsx)(i.code,{children:"service"})," and the ",(0,s.jsx)(i.code,{children:"relativeRef"})," parameter, the ToIP spec is focused on the ",(0,s.jsx)(i.code,{children:"resource"})," parameter - so, if the DID URL contains the ",(0,s.jsx)(i.code,{children:"resource"})," parameter - it must return the resource."]}),"\n",(0,s.jsx)(i.p,{children:"Example:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"did:example:21tDAKCERh95uGgKbJNHYp/some/path?resource=true\n\ndid:example:21tDAKCERh95uGgKbJNHYp/some/longer/path?resource=json\n\ndid:example:21tDAKCERh95uGgKbJNHYp/uuid:33ad7beb-1abc-4a26-b892-466df4379a51/?resource=ld+json\n\ndid:example:21tDAKCERh95uGgKbJNHYp/resources/uuid:33ad7beb-1abc-4a26-b892-466df4379a51/?resource=cbor\n"})}),"\n",(0,s.jsx)(i.p,{children:"The main disadvantage of this approach is that the logic for resolving and fetching the resource associated with the given DID URL completely relies on DID method specification (in the W3C variation it's just a convention and the algorithm for the resource resolution)"}),"\n",(0,s.jsx)(i.p,{children:"ToIP specification doesn't describe the details about the storage of the underlying resource. It might be DLT (blockchain or IPFS) or classic cloud or on-premise storage."}),"\n",(0,s.jsx)(i.h3,{id:"did-url-dereferencing-trust-over-ip-specification---latest",children:"DID URL Dereferencing (Trust over IP specification - latest)"}),"\n",(0,s.jsx)(i.p,{children:"The new specification for DID URL dereferencing is an improved specification with recommended Cheqd idea to publish the resource metadata in the DID Document."}),"\n",(0,s.jsxs)(i.p,{children:["The main difference with the previous specification is an introduction of parameters that can discover the resource (instead of using ",(0,s.jsx)(i.code,{children:"resource"})," field only) and simplification of the Cheqd's approach by skipping the ",(0,s.jsx)(i.code,{children:"collection"})," abstraction."]}),"\n",(0,s.jsx)(i.p,{children:"The DID Document refers to the associated resource via linked resource metadata."}),"\n",(0,s.jsx)(i.p,{children:"The changes to the DID method are also required (described in the Verifiable Data Registry and DID Method Requirements)"}),"\n",(0,s.jsx)(i.p,{children:"The current status of the document is a draft, but it's going to be published in the did-core specification."}),"\n",(0,s.jsx)(i.p,{children:"The list of resource parameters with descriptions is the following:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"resourceUri"})," (required): A string or a map that conforms to the rules of [RFC3986] for URIs which SHOULD directly lead to a location where the resource can be accessed from."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"resourceCollectionId"})," (optional): A string that conforms to a method-specific unique identifier format."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"resourceId"})," (optional): A string that conforms to a method-specific unique identifier format."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"resourceName"})," (required): A string that uniquely names and identifies a resource. This property, along with the resourceType below, can be used to track version changes within a resource."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"resourceType"})," (required): A string that identifies the type of resource. This property, along with the ",(0,s.jsx)(i.code,{children:"resourceName"})," above, can be used to track version changes within a resource. Not to be confused with the media type. (TBC to add to DID Spec Registries)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"resourceVersionId"})," (optional): A string that uniquely identifies the version of the resource provided by the resource creator as a tag."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"mediaType"})," (required): A string that identifies the IANA-registered Media Type for a resource."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"created"})," (required): A JSON String serialized as an XML DateTime normalized to UTC 00:00:00 and without sub-second decimal precision."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"checksum"})," (optional): A string that provides a checksum (e.g. SHA256, MD5) for the resource to facilitate data integrity."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"previousVersionId"})," (optional): The value of the property MUST be a string. This is the previous version of a resource with the same resourceName and resourceType. The value must be 'null' if there is no previous version."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"nextVersionId"})," (optional): The value of the property MUST be a string. This is the previous version of a resource with the same resourceName and resourceType. The value must be 'null' if there is no previous version."]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"This specification describes many important aspects:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"the list of the query parameters in the DID URL for dereferencing the resource and error messages,"}),"\n",(0,s.jsx)(i.li,{children:"DID Method and VDR requirements, and"}),"\n",(0,s.jsx)(i.li,{children:"DID Resolver requirements"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-3",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"interoperability: the resource is resolved in a standard way according to the ToIP specification following W3C specification for DID URL dereferencing"}),"\n",(0,s.jsx)(i.li,{children:"discoverability: the resource defined in DID URL is resolved and fetched dynamically"}),"\n",(0,s.jsx)(i.li,{children:"scalability: compared to W3C specification, the DID Document is not required to fetch the resource, so instead of 2-3 steps (calls), the resource resolution should be completed in a single step. The behavior must be described in the DID Method and implemented by the DID resolver."}),"\n",(0,s.jsxs)(i.li,{children:["trust: publishing the ",(0,s.jsx)(i.code,{children:"checksum"})," of the resource inside of the DID Document allows other SSI system to check the resource validity."]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-3",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:'scalability: the specification is inspired by the Cheqd approach to store the linkedResourceMetadata inside of the DID Document. ToIP specification describes this functionality as optional ("Through associating the resource with a DID Document, the DID Document may generate associated metadata about the resource")'}),"\n",(0,s.jsx)(i.li,{children:"complexity: the specification is the most complex to fetch the resource, so it's not trivial to implement it for all DIDs in the SSI ecosystem."}),"\n",(0,s.jsx)(i.li,{children:"specification: the resolution logic of resources must be described in the DID method and implemented in the DID resolver. As a consequence of this approach, the solution must either communicate directly with the DLT or rely on the SaaS layer for fetching the resources."}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"out-of-the-scope-2",children:"Out of the Scope"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"longevity, and technology stack are not specified in this solution but must be guaranteed by the underlying DLT"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"rootsid---cardano-anoncreds-implementation-of-toip-at-the-cardano-stack",children:"RootsID - Cardano AnonCreds (Implementation of ToIP at the Cardano stack)"}),"\n",(0,s.jsx)(i.p,{children:"RootsID adopted the AnonCreds specification to store the credential schema and credential definition on the Cardano blockchain."}),"\n",(0,s.jsx)(i.p,{children:"Links to the implementation and the method description are in the #Links section for this ADR"}),"\n",(0,s.jsx)(i.p,{children:"It is a proof of concept implementation of ToIP specification of DID URL dereferencing for resolving the resources linked to the DID in TypeScript and Python using Blockfrost REST API to the Cardano blockchain. The Blockfrost SaaS middle layer is used for publishing and fetching the Tx from the Cardano blockchain."}),"\n",(0,s.jsx)(i.p,{children:"The solution is limited to storing AnonCreds entities only but can be extended to store the general resources."}),"\n",(0,s.jsx)(i.p,{children:"For more details, please refer to the source code."}),"\n",(0,s.jsx)(i.p,{children:"As the solution is based on the latest ToIP specification, it derives all positive and negative consequences from the previous but contains the concrete implementation for the Cardano blockchain that solves the trust and longevity aspects of the technical solution."}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-4",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"interoperability: the resource is resolved in a standard way according to the ToIP specification following W3C specification for DID URL dereferencing"}),"\n",(0,s.jsx)(i.li,{children:"discoverability: the resource metadata is published in the DID Document"}),"\n",(0,s.jsx)(i.li,{children:"trust & longevity: is guaranteed by the underlying Cardano blockchain"}),"\n",(0,s.jsx)(i.li,{children:"technology stack: the solution is leveraging Blockfrost REST API for communicating with the Cardano blockchain"}),"\n",(0,s.jsx)(i.li,{children:"technology stack: the solution is stateless and is much cheaper in terms of the infrastructure cost"}),"\n",(0,s.jsx)(i.li,{children:"technology stack: the solution is implemented in Python and TypeScript (mobile platforms can use the same approach as well)"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-4",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"scalability: the specification is inspired by the Cheqd approach to store the linkedResourceMetadata inside of the DID Document"}),"\n",(0,s.jsxs)(i.li,{children:["the convention for references and the logic must be carefully reviewed:","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"schemaId"})," in this solution is ",(0,s.jsx)(i.code,{children:"{didRef}/resources/{cardano_transaction_id}"}),", so it doesn't refer to the ",(0,s.jsx)(i.code,{children:"id"})," but to the Tx where everything else is stored (it's an interesting idea for a stateless design)"]}),"\n",(0,s.jsx)(i.li,{children:"resource metadata is built according to the ToIP specification but for AnonCreds entities only: credential schema and credential definition."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.li,{children:"technology stack: it doesn't fit to current platform, but can be used for inspiration."}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"hyperledger-anoncreds",children:"Hyperledger AnonCreds"}),"\n",(0,s.jsx)(i.p,{children:"According to the AnonCreds specification, such kinds of resources as credential schema and credential definition are stored on-chain. Indy blockchain is used by the Hyperledger technology stack."}),"\n",(0,s.jsx)(i.p,{children:"The credential schema and definition are not signed by the issuer, but the transaction with the underlying resource is published by the issuer. So, the integrity of the resource is guaranteed by the fact that it's published inside of the transaction signed by the issuer."}),"\n",(0,s.jsx)(i.p,{children:"Example of the credential schema transaction:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{\n  "txn": {\n    "data": {\n      "data": {\n        "attr_names": [\n          "birthlocation",\n          "facephoto",\n          "expiry_date",\n          "citizenship",\n          "name",\n          "birthdate",\n          "firstname",\n          "uuid"\n        ],\n        "name": "BasicIdentity",\n        "version": "1.0.0"\n      }\n    },\n    "metadata": {\n      "digest": "06bf8a90335563826154700bf80003598932c8ffaffd4f3656fd8ed604bbb639",\n      "endorser": "Ar1YzNwcM74M2Z4XKUWXMW",\n      "from": "Y6LRXGU3ZCpm7yzjVRSaGu",\n      "payloadDigest": "44e0181c9f9d5080434f9bf11801f1b0768a6b985195e14d56e5dab06fde0cb8",\n      "reqId": 1632381635230531300,\n      "taaAcceptance": {\n        "mechanism": "at_submission",\n        "taaDigest": "8cee5d7a573e4893b08ff53a0761a22a1607df3b3fcd7e75b98696c92879641f",\n        "time": 1632355200\n      }\n    },\n    "protocolVersion": 2,\n    "type": "101",\n    "typeName": "SCHEMA"\n  },\n  "txnMetadata": {\n    "seqNo": 73904,\n    "txnId": "Y6LRXGU3ZCpm7yzjVRSaGu:2:BasicIdentity:1.0.0",\n    "txnTime": "2021-09-23T07:20:40.000Z"\n  }\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"The resource (credential schema) in the current example can be discovered using Indy SDK by the following id:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Y6LRXGU3ZCpm7yzjVRSaGu:2:BasicIdentity:1.0.0\n"})}),"\n",(0,s.jsxs)(i.p,{children:["Technical details and flows are described in the ",(0,s.jsx)(i.a,{href:"https://hyperledger.github.io/anoncreds-spec/",children:"AnonCreds"})," specification."]}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-5",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"discoverability: the credential schema or any other resource is discovered using the Indy SDK"}),"\n",(0,s.jsx)(i.li,{children:"scalability and longevity: are guaranteed by the underlying blockchain technology"}),"\n",(0,s.jsxs)(i.li,{children:["trust: is achieved by underlying blockchain technology, the transaction with the resource contains the hashes and contains the ",(0,s.jsx)(i.code,{children:"digest"}),", ",(0,s.jsx)(i.code,{children:"taaDigest"}),", and ",(0,s.jsx)(i.code,{children:"payloadDigest"})," fields"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-5",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"interoperability: the current solution for storing the resources on-chain is coupled with the Indy blockchain and SDK (it will be mitigated by decoupling the AnonCreds specification from the Indy blockchain)"}),"\n",(0,s.jsx)(i.li,{children:"vendor lock: the solution is tightly coupled to the Indy blockchain (it will be mitigated in the future by decoupling the Aries project from the underlying Indy blockchain)"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Note"}),": there is a new specification of the AnonCreds that is decoupled from the Hyperledger stack. The specification can describe more details about the resource publishing."]}),"\n",(0,s.jsx)(i.h3,{id:"trinsic-solution",children:"Trinsic Solution"}),"\n",(0,s.jsx)(i.p,{children:"The Trinsic solution is built on top of the Hyperledger Aries platform on the Indy blockchain\nThe main benefit is the Trinsic application layer that defines the domain models, entities, REST API and SDK for working with these."}),"\n",(0,s.jsxs)(i.p,{children:["The resource, such as credential schema, is stored on-chain, but the technical complexity and low-level details are hidden under ",(0,s.jsx)(i.code,{children:"Template"})," and ",(0,s.jsx)(i.a,{href:"https://docs.trinsic.id/reference/services/template-service/#template-service",children:(0,s.jsx)(i.code,{children:"Template Service"})})]}),"\n",(0,s.jsx)(i.h4,{id:"positive--negative-consequences",children:"Positive & Negative Consequences"}),"\n",(0,s.jsx)(i.p,{children:"Are similar to the Hyperledger AnonCreds solution"}),"\n",(0,s.jsx)(i.p,{children:"The main benefit of the Trinsic approach to storing resources is a good abstraction layer, documentation, REST API and a variety of supported programming languages in SDKs for dealing with underlying resources."}),"\n",(0,s.jsx)(i.h3,{id:"solution-1-w3c-with-dynamic-resource-resolution",children:"Solution #1 (W3C with dynamic resource resolution)"}),"\n",(0,s.jsx)(i.p,{children:"The solution for storing the resources linked to the DID depends on two decisions that are described in the Context and Problem Statement:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"where the resource is stored"}),"\n",(0,s.jsx)(i.li,{children:"how the resource is discovered and fetched"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Taking into account the advantages and disadvantages of the existing solutions the decision about the solution for the Identus platform might be the following:"}),"\n",(0,s.jsx)(i.p,{children:"-the resource is linked to the DID by convention specified in the W3C specification, so specifying the resource in the DID URL and defining the service endpoint that exposes the resource allows to discover and fetch the resource using the Universal Resolver"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"as an option, the same resource can be discovered and fetched by the Identus platform backend and SDK without loading the Universal resolver"}),"\n",(0,s.jsxs)(i.li,{children:["the resource integrity must be guaranteed by one of the following options:","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"by signing the payload with one of the DID's keys or"}),"\n",(0,s.jsx)(i.li,{children:"by publishing the resource metadata that contains the information about the resource (id, type, name, media type, hash) on-chain or"}),"\n",(0,s.jsx)(i.li,{children:"for the resource that is less than the blockchain limitation (up to 64KB) by publishing the resource together with the hash, and/or signature"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.li,{children:"the resource can be stored in the cloud storage - PostgreSQL database - for indexing and lookup API"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"As the Identus platform can leverage the Cardano blockchain and there is a strong requirement for longevity and security - the resource together with the signature and/or hash must be stored in the Cardano blockchain."}),"\n",(0,s.jsx)(i.p,{children:"An example of this solution will be the following (concerning the current infrastructure and services):"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"prism-node must be able to store the generic resource payload, signature and/or hash on-chain and restore the given resource in the underlying database (PostgreSQL) for indexing and lookup API"}),"\n",(0,s.jsxs)(i.li,{children:["credential schema (or any other resource module) must be a part of the Atala SSI infrastructure and allow","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"publishing the concrete resource as a generic resource using the prism-node API"}),"\n",(0,s.jsx)(i.li,{children:"expose the API for discovery and fetching the resource by URL"}),"\n",(0,s.jsx)(i.li,{children:"expose the API for managing the resources (create, publish, lookup with pagination)"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.li,{children:"the Universal Resolver for the DID Method must be able to discover and fetch the resource by DID URL"}),"\n",(0,s.jsx)(i.li,{children:"is needed, SDK and backend services can fetch the resources directly (not via the Universal Resolver)"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Example:"}),"\n",(0,s.jsx)(i.p,{children:"Given the credential schema with the signature:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{\n  "$id": "driving-license-1.0",\n  "$schema": "http://json-schema.org/draft-07/schema#",\n  "description": "Driving License",\n  "type": "object",\n  "properties": {\n    "credentialSubject": {\n      "type": "object",\n      "properties": {\n        "emailAddress": {\n          "type": "string",\n          "format": "email"\n        },\n        "givenName": {\n           "type": "string"\n        },\n        "familyName": {\n           "type": "string"\n        },\n        "dateOfIssuance": {\n           "type": "datetime"\n        },\n        "drivingLicenseID": {\n           "type": "string"\n        },\n        "drivingClass": {\n           "type": "integer"\n        },\n        "required": [\n          "emailAddress",\n          "familyName",\n          "dateOfIssuance",\n          "drivingLicenseID",\n          "drivingClass"\n        ],\n        "additionalProperties": true\n      }\n    }\n  },\n  "proof": {\n    "type": "RsaSignature2018",\n    "created": "2023-04-18T10:30:00Z",\n    "jws": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6Imh0dHBzOi8vZXhhbXBsZS5jb20vY3JlZGVudGlhbHMvc3ViamVjdCIsInR5cGUiOiJWZXJpZmljYWxpY0NyZWRlbnRpYWwiLCJpc3N1ZXIiOiJodHRwczovL2V4YW1wbGUuY29tL2lzc3VlciIsImlzc3VlckRhdGUiOiIyMDIzLTA0LTE4VDEwOjMwOjAwWiIsImV4cGlyYXRpb25EYXRlIjoiMjAyNC0wNC0xOFQxMDowOTo1MFoiLCJjcmVkZW50aWFsU3ViamVjdCI6eyJpZCI6Imh0dHBzOi8vZXhhbXBsZS5jb20vY3JlZGVudGlhbHMvc3ViamVjdC9zdWJqZWN0IiwibmFtZSI6IkpvaG4gRG9lIiwic2lnbmF0dXJlIjoxMH19.OesuS6eC0gVh8SZpESM7Z4Yln9sGSsJHQ8s0LlcsD99H6_7U6vukUeT2_GZTtuTf9SwIfdtgViFTOfhzGTyM6oMGEeUJv6Umlh6TQ1fTm9XEDQV7JDBiaxRzV7S_vS6i",\n    "alg": "RS256"\n  }\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"In order to store it as a general resource on-chain, it should be binary encoded into CBOR format (or Base64 encoded string) and the metadata must be added to it."}),"\n",(0,s.jsx)(i.p,{children:"For example, it might look like the following JSON object:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{\n        "id": "f3d39687-69f5-4046-a960-3aae86a0d3ca",\n        "name": "DrivingLicense-1.0",\n        "resourceType": "CredentialSchema",\n        "mediaType": "application/json", // MIME Type of the resource\n        "data": "SGVsbG8sIHdvcmxk", // base 64 encoded or CBOR file\n        "did": "did:prism:abdcefg", // the DID reference to link the resource to the DID and create the anchor to the DID\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"... and published on the Cardano blockchain as a payload of the AtalaOperation object, so can be retrieved from the blockchain and added to the indexed database for resolution by the REST API"}),"\n",(0,s.jsxs)(i.p,{children:["Given there is an Agent or CredentialSchema service that exposes the REST API for fetching the credential schema by ID (in the current implementation it corresponds to the Cloud Agent ",(0,s.jsx)(i.code,{children:"/schema-registry/credential-schema/{uuid}"}),", but later might be changed to ",(0,s.jsx)(i.code,{children:"/credential-schema/{didRef}/{id}?version={version}"})," )"]}),"\n",(0,s.jsx)(i.p,{children:"So, the services of the Identus platform and SDKs can resolve the given schema by URL and use the convenient lookup API with filtering and pagination to manage the credential schema in the Web application."}),"\n",(0,s.jsxs)(i.p,{children:["To define the ",(0,s.jsx)(i.code,{children:"schemaId"})," in the message of Issue Credential and Present Proof protocols the following DID URL can be used:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"did:prism:abcdefg1234567890?service=credentialschema&relativeRef=%2Ff3d39687-69f5-4046-a960-3aae86a0d3ca\n"})}),"\n",(0,s.jsxs)(i.p,{children:["The version is skipped as for resolving the single resource we don't need a ",(0,s.jsx)(i.code,{children:"version"})," parameter\n",(0,s.jsx)(i.code,{children:"f3d39687-69f5-4046-a960-3aae86a0d3ca"})," - is a unique identifier that is derived from the triple: didRef, id and version."]}),"\n",(0,s.jsx)(i.p,{children:"So, having the following service endpoint definition in the DID Document:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'{  \n  "service": [\n    {\n      "id": "did:prism:abcdefg#credentialschema",\n      "type": "CredentialSchemaService",\n      "serviceEndpoint": "https://agent.example.com/schema-registry/schemas"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(i.p,{children:"And having the logic for dereferencing the DID URL in the PRISM DID Resolver, any system in the SSI ecosystem can fetch this resource and validate its authorship."}),"\n",(0,s.jsx)(i.p,{children:"Storing resources larger than 64KB is out of the scope of this ADR. These must be stored in a slightly different way, for instance, the image ~10MB, can be stored and linked to the DID Document in the following way:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"the image is stored in the cloud database in a binary format"}),"\n",(0,s.jsx)(i.li,{children:"the metadata and the hash of the image are stored on-chain"}),"\n",(0,s.jsx)(i.li,{children:"optionally, the signature of the owner DID can be generated for the payload and stored together with the hash"}),"\n",(0,s.jsx)(i.li,{children:"to prove the integrity of the image file, the hash of the binary representation must be the same and/or the signature must be verified"}),"\n",(0,s.jsx)(i.li,{children:"the resource can be fetched in the same way and the credential schema from the previous example"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-6",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"discoverability: the credential schema or any other resource is discovered using the Universal Resolver"}),"\n",(0,s.jsx)(i.li,{children:"scalability: the size of DID document doesn't grow when a new resource is added, the number of the resources is limited by the scalability of the underlying database and the blockchain"}),"\n",(0,s.jsx)(i.li,{children:"longevity: for the resource that can be stored on-chain the longevity is 100% guaranteed by the underlying blockchain technology"}),"\n",(0,s.jsx)(i.li,{children:"trust: is achieved by cryptography and the underlying blockchain technology, the transaction with the resource contains the hashes and the signatures that can be verified"}),"\n",(0,s.jsx)(i.li,{children:"interoperability: any system that uses Universal Resolver can fetch the resource by dereferencing the DID URL (following the  W3C specification)"}),"\n",(0,s.jsx)(i.li,{children:"vendor lock: by publishing the specifications and the algorithms for fetching the data, the resource can be resolved by any other SSI system"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-6",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"longevity: for the resource that can not be stored on-chain because of the large size longevity is guaranteed by the cloud recovery procedures and data backup. As an option for mitigating this problem, the resource can be stored in IPFS (additional ADR is required for this)"}),"\n",(0,s.jsx)(i.li,{children:"vendor lock: the solution is coupled to the Cardano blockchain"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"NOTE:"})," one of the main concerns of this ADR is storing the resources on-chain because of size limitation, throughput, latency and cost. This option allows to postpone this decision and implement the DID-linked resources without the need of storing resources on-chain."]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h3,{id:"solution-2-toip-specification-implementation",children:"Solution #2 (ToIP specification implementation)"}),"\n",(0,s.jsx)(i.p,{children:"ToIP specification can be used to implement the resource resolution.\nTo implement it the following things are required:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"specify in the DID method the logic of resolution of the resources from the DID URL"}),"\n",(0,s.jsx)(i.li,{children:"specify the service mapping in the DID method and implement the resource resolution logic in the DID resolver"}),"\n",(0,s.jsxs)(i.li,{children:["add ",(0,s.jsx)(i.code,{children:"didDocumentMetadata.linkedResourceMetadata"})," field to the DID method and implement the logic in the VDR layer"]}),"\n",(0,s.jsx)(i.li,{children:"implement the service layer according to the ToIP specification"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"ToIP solution specifies the requirements to the VDR (blockchain) that is not easy to achieve with the current implementation of the Identus platform.\nAccording to this specification, the Universal Resolver must have the direct access to the blockchain or use a centralized layer for fetching the resources over REST API.\nBefore implementing this specification is the Identus platform we need to answer the following questions:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["who is hosting the ",(0,s.jsx)(i.code,{children:"prism-node"})," infrastructure for the Universal Resolver and how it's managed?"]}),"\n",(0,s.jsx)(i.li,{children:"should we make the PRISM DID Method responsible for resource resolution logic?"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"positive-consequences-7",children:"Positive Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"interoperability: the resource is resolved in a standard way according to the ToIP specification following W3C specification for DID URL dereferencing"}),"\n",(0,s.jsx)(i.li,{children:"discoverability: the resource defined in DID URL is resolved and fetched dynamically"}),"\n",(0,s.jsx)(i.li,{children:"scalability: compared to W3C specification, the DID Document is not required to fetch the resource, so instead of 2-3 steps (calls), the resource resolution should be completed in a single step. The behavior must be described in the DID Method and implemented by the DID resolver."}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"negative-consequences-7",children:"Negative Consequences"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"complexity: the solution is complex and over-engineered. A lot of components and flows must be defined to fetch the resource."}),"\n",(0,s.jsx)(i.li,{children:"specification: current approach might be changed as it's still in the draft status, so implementing it is risky"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"decision-outcome",children:"Decision Outcome"}),"\n",(0,s.jsx)(i.p,{children:"Each option has technical challenges and limitations, but it's possible to define the following decisions as an outcome:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"the resource MUST be stored on-chain to guarantee trust and longevity aspects, for the Identus platform it is the Cardano blockchain"}),"\n",(0,s.jsx)(i.li,{children:"the resource SHOULD be indexed for quick lookup over the API"}),"\n",(0,s.jsx)(i.li,{children:"the resource CAN be referenced in the DID Document for additional discoverability"}),"\n",(0,s.jsx)(i.li,{children:"the resource MUST be dereferenced from the DID URL according to W3C or ToIP specification and implementation"}),"\n",(0,s.jsx)(i.li,{children:"the resource resolution CAN be described in the DID Method (for the dynamic resource linking and W3C dereferencing algorithm it's not required)"}),"\n",(0,s.jsx)(i.li,{children:"the complexity of the solution SHOULD be adequate to the original goal: get the resource linked to the DID"}),"\n",(0,s.jsx)(i.li,{children:"the solution SHOULD be scalable"}),"\n",(0,s.jsx)(i.li,{children:"the solution MUST be interoperable and easily adopted by the SSI ecosystem"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"The solution option #1 is considered a good option as it satisfies the requirements and the majority of the negative consequences are mitigated.\nThe following comparison table is a summary of the available options."}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Option"}),(0,s.jsx)(i.th,{children:"Simplicity"}),(0,s.jsx)(i.th,{children:"Trust"}),(0,s.jsx)(i.th,{children:"Scalability"}),(0,s.jsx)(i.th,{children:"Interop"}),(0,s.jsx)(i.th,{children:"Discoverability"}),(0,s.jsx)(i.th,{children:"Decentalisation"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"linkedResources field"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"N/A"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"linkedResourceMetadata (Cheqd)"}),(0,s.jsxs)(i.td,{children:["\u2796","/","\u2795"]}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsxs)(i.td,{children:["\u2796","/","\u2795"]}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"DID URL Dereferencing (W3C specification)"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"N/A"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"DID URL Dereferencing (ToIP specification)"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsxs)(i.td,{children:["\u2795","/","\u2796"]}),(0,s.jsxs)(i.td,{children:["\u2795","/","\u2796"]}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"RootsID - Cardano AnonCreds"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsxs)(i.td,{children:["\u2795","/","\u2796"]}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Hyperledger AnonCreds"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Trinsic"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsxs)(i.td,{children:["\u2795","/","\u2796"]}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Solution #1 W3C"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Solution #2 ToIP"}),(0,s.jsx)(i.td,{children:"\u2796"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"}),(0,s.jsxs)(i.td,{children:["\u2796","/","\u2795"]}),(0,s.jsxs)(i.td,{children:["\u2795","/","\u2796"]}),(0,s.jsx)(i.td,{children:"\u2795"}),(0,s.jsx)(i.td,{children:"\u2714\ufe0f"})]})]})]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.p,{children:"Each option reviewed in this ADR is a composition of the following architectural decisions:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"the resource is stored on-chain or off-chain"}),"\n",(0,s.jsx)(i.li,{children:"the VDR layer is managed or unmanaged (for instance, leveraging the Blockfrost REST API can simplify the solution, but might be expensive at scale)"}),"\n",(0,s.jsx)(i.li,{children:"domestic or official (W3C/ToIP specification implementation"}),"\n",(0,s.jsx)(i.li,{children:"static/dynamic resource discoverability (is resource metadata stored in the DID Document or not)"}),"\n",(0,s.jsx)(i.li,{children:"DID URL dereferencing algorithm and naming convention"}),"\n",(0,s.jsx)(i.li,{children:"level of trust: Tx signature, resource hash, resource signature"}),"\n",(0,s.jsx)(i.li,{children:"decentralized or SaaS solution"}),"\n",(0,s.jsx)(i.li,{children:"SDK, Universal Resolver or REST API for fetching the resource"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"The main benefits of option #1 for the Identus platform are the following:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"the resource is stored on-chain"}),"\n",(0,s.jsx)(i.li,{children:"the resource is published and indexed by the managed VDR layer (prism-node)"}),"\n",(0,s.jsx)(i.li,{children:"the resource is available via REST API & SDK for the product-level applications"}),"\n",(0,s.jsx)(i.li,{children:"the resource is dereferenced via the DID URL in the DID resolver"}),"\n",(0,s.jsx)(i.li,{children:"the resource is linked to the DID dynamically (using DID URL + dereferencing algorithm)"}),"\n",(0,s.jsx)(i.li,{children:"this solution is scalable and decentralized (anyone can deploy the Identus stack)"}),"\n",(0,s.jsx)(i.li,{children:"level of trust can be guaranteed by the underlying VDR and enforced by hashes or signatures of the resource"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"links",children:"Links"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://blog.cheqd.io/our-approach-to-resources-on-ledger-25bf5690c975",children:"Our Approach to DID-Linked Resources"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://docs.cheqd.io/identity/guides/did-linked-resources/context",children:"Context for Developing DID-Linked Resources"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://docs.cheqd.io/identity/architecture/adr-list/adr-002-did-linked-resources",children:"ADR 002: DID-Linked Resources"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://hyperledger.github.io/anoncreds-spec/#schema-publisher-publish-schema-object",children:"Hyperledger Anoncreds - Schema Publisher: Publish Schema Object"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://wiki.trustoverip.org/display/HOME/DID+URL+Resource+Parameter+Specification",children:"ToIP - DID URL Resource Parameter Specification"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://wiki.trustoverip.org/display/HOME/DID-Linked+Resources+Specification",children:"ToPI - DID-Linder Resources Specification"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://www.w3.org/TR/did-core/#did-parameters",children:"DID-Core#did-parameters"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://w3c-ccg.github.io/did-resolution/#dereferencing",children:"DID-Resolution#dereferencing"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://github.com/roots-id/cardano-anoncreds/blob/main/cardano-anoncred-methods.md",children:"RootsID AnonCreds Methods"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"https://github.com/roots-id/cardano-anoncreds",children:"RootsID Cardano AnonCreds repo"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>c});var s=n(96540);const t={},r=s.createContext(t);function o(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);