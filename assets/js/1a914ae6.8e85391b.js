"use strict";(self.webpackChunkidentus_documentation_portal=self.webpackChunkidentus_documentation_portal||[]).push([[7571],{57765:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var n=t(74848),s=t(28453);const o={},r="Hierarchical deterministic key generation algorithm",a={id:"decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm",title:"Hierarchical deterministic key generation algorithm",description:"- Status: accepted",source:"@site/documentation/adrs/decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm.md",sourceDirName:"decisions",slug:"/decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm",permalink:"/identus-docs/adrs/decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"adrsSidebar",previous:{title:"Mediator message storage",permalink:"/identus-docs/adrs/decisions/2023-05-15-mediator-message-storage"},next:{title:"Data isolation for multi-tenancy",permalink:"/identus-docs/adrs/decisions/2023-05-18-data-isolation-for-multitenancy"}},d={},l=[{value:"Context and Problem Statement",id:"context-and-problem-statement",level:2},{value:"Out of the Scope",id:"out-of-the-scope",level:2},{value:"<code>did:peer</code>",id:"didpeer",level:3},{value:"Recovery Procedure",id:"recovery-procedure",level:3},{value:"Implementation details",id:"implementation-details",level:3},{value:"Secure Storage",id:"secure-storage",level:3},{value:"Backward Compatibility with the PRISM v1.4",id:"backward-compatibility-with-the-prism-v14",level:3},{value:"Decision Drivers",id:"decision-drivers",level:2},{value:"Considered Option",id:"considered-option",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Positive Consequences",id:"positive-consequences",level:3},{value:"Negative Consequences",id:"negative-consequences",level:3},{value:"Links",id:"links",level:2}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"hierarchical-deterministic-key-generation-algorithm",children:"Hierarchical deterministic key generation algorithm"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Status: accepted"}),"\n",(0,n.jsx)(i.li,{children:"Deciders: Jesus Diaz Vico, Ezequiel Postan, Pat Losoponkul, Yurii Shynbuiev"}),"\n",(0,n.jsx)(i.li,{children:"Date: 2023-05-16"}),"\n",(0,n.jsx)(i.li,{children:"Revision-date: 2024-06-06"}),"\n",(0,n.jsx)(i.li,{children:"Tags: key management, hierarchical deterministic, key derivation"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Technical Story:"}),"\n",(0,n.jsxs)(i.p,{children:["Current ADR is based on the Research Spike ",(0,n.jsx)(i.a,{href:"https://drive.google.com/file/d/1SRHWRqY1C88eVuaS1v_uIAt-LNTLi9aO/view",children:"Evaluation of Using a Single Mnemonic both for Cryptocurrency and Identity Wallets"})," document was written by Atala engineers:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Jesus Diaz Vico (Atala Semantics team)"}),"\n",(0,n.jsx)(i.li,{children:"Christos KK Loverdos (Atala Technical Director)"}),"\n",(0,n.jsx)(i.li,{children:"Ezequiel Postan (Atala Semantics team)"}),"\n",(0,n.jsx)(i.li,{children:"Tony Rose (Atala Head of Product)"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Reviewed in 2024 by Atala engineers:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Jesus Diaz Vico"}),"\n",(0,n.jsx)(i.li,{children:"Ezequiel Postan"}),"\n",(0,n.jsx)(i.li,{children:"Pat Losoponkul"}),"\n",(0,n.jsx)(i.li,{children:"Gon\xe7alo Frade"}),"\n",(0,n.jsx)(i.li,{children:"Yurii Shynbuiev"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"The document covers motivation, the overview of BIP32-based HD wallets, and the main concept and implementation details."}),"\n",(0,n.jsx)(i.h2,{id:"context-and-problem-statement",children:"Context and Problem Statement"}),"\n",(0,n.jsx)(i.p,{children:"The Identus Platform must provide the hierarchical deterministic (HD) key derivation algorithm for the identity wallets managed by the platform (Cloud Agent and SDKs)"}),"\n",(0,n.jsxs)(i.p,{children:["HD key derivation can be used for both ",(0,n.jsx)(i.code,{children:"managed"})," and ",(0,n.jsx)(i.code,{children:"unmanaged"})," solutions. In both cases, the key material is created from the ",(0,n.jsx)(i.code,{children:"seed"}),"."]}),"\n",(0,n.jsxs)(i.p,{children:["In the case of a ",(0,n.jsx)(i.code,{children:"managed"})," solution, the keys are created by the ",(0,n.jsx)(i.code,{children:"Agent"})," or ",(0,n.jsx)(i.code,{children:"SDK"})," and stored in the ",(0,n.jsx)(i.code,{children:"secured storage"})," that is managed by the Identus platform."]}),"\n",(0,n.jsxs)(i.p,{children:["In the case of an ",(0,n.jsx)(i.code,{children:"unmanaged"})," solution, the key material is created by the tools (for instance, ",(0,n.jsx)(i.code,{children:"identus-cli"}),") following similar rules, and is stored on the client side in the ",(0,n.jsx)(i.code,{children:"secret storage"})," managed by the client."]}),"\n",(0,n.jsx)(i.p,{children:"We are going to be using different derivation implementations for secp256k1 and ed25519."}),"\n",(0,n.jsx)(i.h2,{id:"out-of-the-scope",children:"Out of the Scope"}),"\n",(0,n.jsx)(i.h3,{id:"didpeer",children:(0,n.jsx)(i.code,{children:"did:peer"})}),"\n",(0,n.jsx)(i.p,{children:"DID peer key material derivation is out of the scope of this ADR, so this type of DIDs is created dynamically from the secure random"}),"\n",(0,n.jsx)(i.h3,{id:"recovery-procedure",children:"Recovery Procedure"}),"\n",(0,n.jsxs)(i.p,{children:["Key material recovery procedure is out of the scope of this ADR, but the main idea is the following: having a ",(0,n.jsx)(i.code,{children:"seed"})," and the latest versions of the DID Documents published on-chain it is possible to recover all the key materials related to the latest state of the identity wallet related to DIDs."]}),"\n",(0,n.jsx)(i.h3,{id:"implementation-details",children:"Implementation details"}),"\n",(0,n.jsx)(i.p,{children:"The HD key derivation algorithm is a part of the Apollo building block, the choice of the programming language is up to the engineering team."}),"\n",(0,n.jsx)(i.h3,{id:"secure-storage",children:"Secure Storage"}),"\n",(0,n.jsx)(i.p,{children:"Secure store implementation is a matter of another ADR. By now, the Hashicorp Vault is going to be used by the Identus platform by default."}),"\n",(0,n.jsx)(i.h3,{id:"backward-compatibility-with-the-prism-v14",children:"Backward Compatibility with the PRISM v1.4"}),"\n",(0,n.jsxs)(i.p,{children:["The current decision doesn't have backward compatibility with the PRISM v1.4, but it can be mitigated by switching to the ",(0,n.jsx)(i.code,{children:"unmanaged"})," way of key management for the DIDs created in v1.4 or by implementing the backward compatibility module in the Identus Platform"]}),"\n",(0,n.jsx)(i.h2,{id:"decision-drivers",children:"Decision Drivers"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Deterministic key derivation for the Identus Platform and in all components: Cloud Agent (JVM), Identity Wallets (Android, iOS, Web)"}),"\n",(0,n.jsxs)(i.li,{children:["Possibility to use the same ",(0,n.jsx)(i.code,{children:"seed"})," value for ",(0,n.jsx)(i.code,{children:"crypto"})," and ",(0,n.jsx)(i.code,{children:"identity"})," wallets."]}),"\n",(0,n.jsx)(i.li,{children:"Compliance with BIP32 specification"}),"\n",(0,n.jsx)(i.li,{children:"Key material migration between the wallets"}),"\n",(0,n.jsx)(i.li,{children:"Key material recovery in case of disaster"}),"\n",(0,n.jsx)(i.li,{children:"We must use different derivation standards bip32 with secp256k1 and ed25519-bip32"}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"considered-option",children:"Considered Option"}),"\n",(0,n.jsx)(i.p,{children:"Implement the HD key derivation algorithm according to the research spike for all the components of the Identus Platform.\nThe derivation path contains the following segments/layers:"}),"\n",(0,n.jsx)(i.p,{children:"m/wallet-purpose'/did-method'/did-index'/key-purpose'/key-index'"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"wallet purpose"})," is used to distinguish the wallet purpose for the identity wallet and is a constant for the Identus platform ",(0,n.jsx)(i.code,{children:"0x1D"}),", which looks like ID"]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"did-method"})," - the DID method that the key will be generated for. The value of ",(0,n.jsx)(i.code,{children:"did-method"})," should be registered. The following are available values for the ",(0,n.jsx)(i.code,{children:"did-method"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["PRISM DID method - ",(0,n.jsx)(i.code,{children:"0x1d"})]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"did-index"})," - the index of the DID, it's possible to create"]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"key-purpose"})," - the purpose of the key associated with the DID. There are the following available values for the ",(0,n.jsx)(i.code,{children:"key purpose"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"master key 1 - is the most privileged key type, when any other key is lost, you could use this to recover the others"}),"\n",(0,n.jsx)(i.li,{children:"issuing key 2 - is used for issuing credentials only, it should be kept in a safe place to avoid malicious credentials being issued."}),"\n",(0,n.jsx)(i.li,{children:"key-agreement key 3 - is used to establish a shared symmetric key for secure end-to-end communication, use this key type to encrypt the content."}),"\n",(0,n.jsx)(i.li,{children:"authentication key 4 - is used to authenticate requests or log into services."}),"\n",(0,n.jsx)(i.li,{children:"revocation key 5 - is used for revoking credentials only, it should be kept in a safe place to avoid malicious credentials being issued."}),"\n",(0,n.jsx)(i.li,{children:"capability-invocation key 6 - is used to specify a verification method that might be used by the DID subject to invoke a cryptographic capability, such as the authorization to update the DID Document."}),"\n",(0,n.jsx)(i.li,{children:"capability-delegation key 7 - is used to specify a mechanism that might be used by the DID subject to delegate a cryptographic capability to another party, such as delegating the authority to access a specific HTTP API to a subordinate."}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"key-index"})," - the index of the key pair"]}),"\n",(0,n.jsx)(i.p,{children:"In order to generate key material (private and public keys):"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Secp256k1 ellipstic curve will be used with standard bip32 derivation"}),"\n",(0,n.jsxs)(i.li,{children:["Curve25519 (Ed25519) will be used with the standard bip32 implementation for ",(0,n.jsx)(i.a,{href:"https://ieeexplore.ieee.org/document/7966967",children:"ed25519"})]}),"\n",(0,n.jsx)(i.li,{children:"Future implementations will require their own implementations of the derive function, and very potentially at some point we may want to rework bip32 implementation to make it more agnostic, because a high percentage of the code is going to be the same."}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"Seed"})," entropy must be used for the HD algorithm is 256 bits which corresponds to 24 words mnemonic"]}),"\n",(0,n.jsx)(i.h2,{id:"decision-outcome",children:"Decision Outcome"}),"\n",(0,n.jsxs)(i.p,{children:["The PRIMS platform uses HD key derivation algorithm for ",(0,n.jsx)(i.code,{children:"managed"})," and ",(0,n.jsx)(i.code,{children:"unmanaged"})," solutions based on the research spike the current ADR."]}),"\n",(0,n.jsx)(i.h3,{id:"positive-consequences",children:"Positive Consequences"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"deterministic key material derivation among all components of the Identus platform"}),"\n",(0,n.jsx)(i.li,{children:"BIP32 compliance (for both secp256k1 and ed25519 with their corresponding implementations)"}),"\n",(0,n.jsx)(i.li,{children:"key material migration capability"}),"\n",(0,n.jsx)(i.li,{children:"key material recovery capability"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"negative-consequences",children:"Negative Consequences"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["backward compatibility with the key material created by PRISM v1.4 version (can be mitigated by removing the ",(0,n.jsx)(i.code,{children:"wallet_purpose"})," from the derivation path)"]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"links",children:"Links"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://drive.google.com/file/d/1SRHWRqY1C88eVuaS1v_uIAt-LNTLi9aO/view",children:"Evaluation of Using a Single Mnemonic both for Cryptocurrency and Identity Wallets"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>r,x:()=>a});var n=t(96540);const s={},o=n.createContext(s);function r(e){const i=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(o.Provider,{value:i},e.children)}}}]);