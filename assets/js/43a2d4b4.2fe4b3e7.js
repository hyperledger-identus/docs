"use strict";(globalThis.webpackChunkidentus_documentation_portal=globalThis.webpackChunkidentus_documentation_portal||[]).push([[53871],{4127:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"cloud-agent/docs/docusaurus/connections/connection","title":"Connections","description":"A connection is a stateful relationship between two parties that enables secure communication.","source":"@site/cloud-agent/docs/docusaurus/connections/connection.md","sourceDirName":"cloud-agent/docs/docusaurus/connections","slug":"/cloud-agent/docs/docusaurus/connections/connection","permalink":"/docs/cloud-agent/docs/docusaurus/connections/connection","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"developersSidebar","previous":{"title":"Quick Start Guide","permalink":"/docs/documentation/developers/quick-start"},"next":{"title":"Credentials","permalink":"/docs/category/credentials"}}');var o=i(74848),c=i(28453);const s={},a="Connections",d={},r=[{value:"Roles",id:"roles",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Cloud Agent endpoints overview",id:"cloud-agent-endpoints-overview",level:2},{value:"Inviter Flow",id:"inviter-flow",level:2},{value:"Invitee Flow",id:"invitee-flow",level:2},{value:"Sequence diagram",id:"sequence-diagram",level:2},{value:"Command line example",id:"command-line-example",level:2},{value:"Inviter creates an invitation",id:"inviter-creates-an-invitation",level:3},{value:"<strong>Invitee</strong> accepts OOB invitation",id:"invitee-accepts-oob-invitation",level:3},{value:"Invitee retrieves the list of connections",id:"invitee-retrieves-the-list-of-connections",level:3},{value:"Inviter retrieves the list of connections",id:"inviter-retrieves-the-list-of-connections",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"connections",children:"Connections"})}),"\n",(0,o.jsx)(n.p,{children:"A connection is a stateful relationship between two parties that enables secure communication."}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"/documentation/learn/glossary#connection-protocol",children:"Connection protocol"})," is required to establish secure connections between agents,\nallowing them to exchange information and interact."]}),"\n",(0,o.jsx)(n.h2,{id:"roles",children:"Roles"}),"\n",(0,o.jsx)(n.p,{children:"The connection protocol has two roles:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/learn/glossary#inviter",children:"Inviter"}),": A subject that initiates a connection request by sending a ",(0,o.jsx)(n.a,{href:"/documentation/learn/glossary#connection-invitation",children:"connection invitation"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/learn/glossary#invitee",children:"Invitee"}),": A subject that receives a connection invitation and accepts it by sending a ",(0,o.jsx)(n.a,{href:"/documentation/learn/glossary#connection-request",children:"connection request"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Inviter and Invitee Cloud Agents up and running"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"cloud-agent-endpoints-overview",children:"Cloud Agent endpoints overview"}),"\n",(0,o.jsx)(n.p,{children:"The protocol uses the following REST API endpoints:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference/#tag/Connections-Management",children:(0,o.jsx)(n.code,{children:"/connections"})}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference/#tag/Connections-Management/operation/createConnection",children:(0,o.jsx)(n.code,{children:"POST"})}),": Creates a new connection and returns an invitation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference/#tag/Connections-Management/operation/getConnections",children:(0,o.jsx)(n.code,{children:"GET"})}),": Returns a list of connections"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference/#tag/Connections-Management/operation/getConnection",children:(0,o.jsx)(n.code,{children:"GET /connections/{connectionId}"})}),": Returns an existing connection record by id"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference/#tag/Connections-Management/operation/acceptConnectionInvitation",children:(0,o.jsx)(n.code,{children:"POST /connection-invitations"})}),": Accepts an externally received invitation"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Please check the full ",(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference",children:"Cloud Agent API"})," specification for more detailed information."]})}),"\n",(0,o.jsx)(n.h2,{id:"inviter-flow",children:"Inviter Flow"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Generate and share a new Out-of-Band (OOB) invitation (connection gets created in ",(0,o.jsx)(n.code,{children:"InvitationGenerated"})," state)"]}),"\n",(0,o.jsxs)(n.li,{children:["Receive a connection request from the Invitee (connection moves to ",(0,o.jsx)(n.code,{children:"ConnectionRequestReceived"})," state)"]}),"\n",(0,o.jsxs)(n.li,{children:["Accept the connection request (connection moves to ",(0,o.jsx)(n.code,{children:"ConnectionResponsePending"})," state)"]}),"\n",(0,o.jsxs)(n.li,{children:["Send the connection response via the DIDComm Agent (connection achieves ",(0,o.jsx)(n.code,{children:"ConnectionResponseSent"})," state)"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The following diagram represents the Inviter's Connection state transitions:"}),"\n",(0,o.jsx)(n.mermaid,{value:"---\ntitle: Inviter Connection State\n---\nstateDiagram-v2\n[*] --\x3e InvitationGenerated: generate and share new OOB invitation\nInvitationGenerated --\x3e ConnectionRequestReceived: receive connection request\nConnectionRequestReceived --\x3e ConnectionResponsePending: accept connection request\nConnectionResponsePending --\x3e ConnectionResponseSent: send connection response (DIDComm)\nConnectionResponseSent --\x3e [*]"}),"\n",(0,o.jsx)(n.h2,{id:"invitee-flow",children:"Invitee Flow"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Receive the OOB invitation (",(0,o.jsx)(n.code,{children:"InvitationReceived"})," state)"]}),"\n",(0,o.jsxs)(n.li,{children:["Accept the invitation (connection is created in ",(0,o.jsx)(n.code,{children:"ConnectionRequestPending"})," state)"]}),"\n",(0,o.jsxs)(n.li,{children:["Send the connection request via ",(0,o.jsx)(n.a,{href:"/documentation/learn/glossary#didcomm",children:"DIDComm"})," (connection achieves ",(0,o.jsx)(n.code,{children:"ConnectionRequestSent"})," state)"]}),"\n",(0,o.jsxs)(n.li,{children:["Receive the connection response (connection achieves ",(0,o.jsx)(n.code,{children:"ConnectionResponseReceived"})," state)"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The following diagram represents the Invitee's Connection state transitions:"}),"\n",(0,o.jsx)(n.mermaid,{value:"---\ntitle: Invitee Connection State\n---\nstateDiagram-v2\n[*] --\x3e InvitationReceived: receive OOB invitation\nInvitationReceived --\x3e ConnectionRequestPending: accept invitation\nConnectionRequestPending --\x3e ConnectionRequestSent: send connection request (DIDComm)\nConnectionRequestSent --\x3e ConnectionResponseReceived: receive connection response\nConnectionResponseReceived --\x3e [*]"}),"\n",(0,o.jsx)(n.h2,{id:"sequence-diagram",children:"Sequence diagram"}),"\n",(0,o.jsx)(n.p,{children:"The following diagram shows the end-to-end flow for establishing a connection between an inviter and an invitee."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:i(17178).A+"",width:"1333",height:"1462"})}),"\n",(0,o.jsx)(n.h2,{id:"command-line-example",children:"Command line example"}),"\n",(0,o.jsx)(n.p,{children:"The following example demonstrates how you could use two Cloud Agent APIs to set up a connection between them."}),"\n",(0,o.jsx)(n.h3,{id:"inviter-creates-an-invitation",children:"Inviter creates an invitation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X 'POST' \\\n 'http://localhost:8080/cloud-agent/connections' \\\n -H 'Content-Type: application/json' \\\n -H \"apikey: $API_KEY\" \\\n -d '{ \"label\": \"Connect with Alice\" }' | jq\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "connectionId": "1893e207-4cba-4792-8179-067c78d2acc2",\n  "createdAt": "2023-02-02T17:14:13.593647Z",\n  "invitation": {\n    "from": "did:peer:inviter-did",\n    "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n    "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n    "type": "https://didcomm.org/out-of-band/2.0/invitation"\n  },\n  "kind": "/connections/1893e207-4cba-4792-8179-067c78d2acc2",\n  "label": "Connect with Alice",\n  "self": "Connection",\n  "state": "InvitationGenerated"\n}\n'})}),"\n",(0,o.jsxs)(n.h3,{id:"invitee-accepts-oob-invitation",children:[(0,o.jsx)(n.strong,{children:"Invitee"})," accepts OOB invitation"]}),"\n",(0,o.jsxs)(n.p,{children:["Replace ",(0,o.jsx)(n.code,{children:"{RAW_INVITATION}"})," with the value of the '_oob' query string parameter from the invitation URL above"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X 'POST' \\\n 'http://localhost:8090/cloud-agent/connection-invitations' \\\n -H 'Content-Type: application/json' \\\n -H \"apikey: $API_KEY\" \\\n -d '{ \"invitation\": \"{RAW_INVITATION}\" }' | jq\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "connectionId": "755a457a-878e-4292-a3f2-cb83601f802e",\n  "createdAt": "2023-02-02T18:05:58Z",\n  "invitation": {\n    "from": "did:peer:inviter-did",\n    "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n    "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n    "type": "https://didcomm.org/out-of-band/2.0/invitation"\n  },\n  "kind": "/connections/755a457a-878e-4292-a3f2-cb83601f802e",\n  "myDid": "did:peer:invitee-did",\n  "self": "Connection",\n  "state": "ConnectionRequestPending",\n  "theirDid": "did:peer:inviter-did",\n  "updatedAt": "2023-02-02T18:05:59Z"\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"invitee-retrieves-the-list-of-connections",children:"Invitee retrieves the list of connections"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X 'GET' 'http://localhost:8090/cloud-agent/connections' \\\n    -H \"apikey: $API_KEY\" | jq\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "contents": [\n    {\n      "connectionId": "755a457a-878e-4292-a3f2-cb83601f802e",\n      "createdAt": "2023-02-02T18:05:58Z",\n      "invitation": {\n        "from": "did:peer:issuer-did",\n        "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n        "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n        "type": "https://didcomm.org/out-of-band/2.0/invitation"\n      },\n      "kind": "/connections/755a457a-878e-4292-a3f2-cb83601f802e",\n      "myDid": "did:peer:holder-did",\n      "self": "Connection",\n      "state": "ConnectionResponseReceived",\n      "theirDid": "did:peer:issuer-did",\n      "updatedAt": "2023-02-02T18:06:14Z"\n    }\n  ],\n  "kind": "Collection",\n  "self": "/collections"\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"inviter-retrieves-the-list-of-connections",children:"Inviter retrieves the list of connections"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X 'GET' 'http://localhost:8080/cloud-agent/connections' \\\n    -H \"apikey: $API_KEY\" | jq\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "contents": [\n    {\n      "connectionId": "1893e207-4cba-4792-8179-067c78d2acc2",\n      "createdAt": "2023-02-02T17:14:13Z",\n      "invitation": {\n        "from": "did:peer:issuer-did",\n        "id": "1893e207-4cba-4792-8179-067c78d2acc2",\n        "invitationUrl": "https://domain.com/path?_oob={RAW_INVITATION}",\n        "type": "https://didcomm.org/out-of-band/2.0/invitation"\n      },\n      "kind": "/connections/1893e207-4cba-4792-8179-067c78d2acc2",\n      "label": "Connect with Alice",\n      "myDid": "did:peer:issuer-did",\n      "self": "Connection",\n      "state": "ConnectionResponseSent",\n      "theirDid": "did:peer:holder-did",\n      "updatedAt": "2023-02-02T18:06:16Z"\n    }\n  ],\n  "kind": "Collection",\n  "self": "/collections"\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Please check the full ",(0,o.jsx)(n.a,{href:"/documentation/reference/Cloud%20Agent%20API/identus-cloud-agent-api-reference",children:"Cloud Agent API"})," specification for more detailed information."]})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},17178:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/connection-flow-1c40a0f648b72caed0223ec70bdba546.png"},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var t=i(96540);const o={},c=t.createContext(o);function s(e){const n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);