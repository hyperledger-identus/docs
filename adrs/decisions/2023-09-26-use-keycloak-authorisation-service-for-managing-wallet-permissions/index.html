<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-adrs docs-version-current docs-doc-page docs-doc-id-decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Use keycloak authorisation service for managing wallet permissions | Hyperledger Identus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hyperledger-identus.github.io/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-adrs-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-adrs-current"><meta data-rh="true" property="og:title" content="Use keycloak authorisation service for managing wallet permissions | Hyperledger Identus"><meta data-rh="true" name="description" content="- Status: accepted"><meta data-rh="true" property="og:description" content="- Status: accepted"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hyperledger-identus.github.io/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions"><link data-rh="true" rel="alternate" href="https://hyperledger-identus.github.io/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions" hreflang="en"><link data-rh="true" rel="alternate" href="https://hyperledger-identus.github.io/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.23a80006.css">
<script src="/docs/assets/js/runtime~main.1d53bfab.js" defer="defer"></script>
<script src="/docs/assets/js/main.09586b44.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/identus-navbar-light.png" alt=" Identus logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/identus-navbar-light.png" alt=" Identus logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/home/">Home</a><a class="navbar__item navbar__link" href="/docs/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/adrs/">ADRs</a><a class="navbar__item navbar__link" href="/docs/agent-api/">Agent API</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions">SDKs</a><ul class="dropdown__menu"><li><a href="https://hyperledger-identus.github.io/sdk-swift/documentation/edgeagentsdk/" target="_blank" rel="noopener noreferrer" class="dropdown__link">SDK Swift<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/docs/sdk-ts/sdk">SDK Typescript</a></li><li><a href="https://hyperledger-identus.github.io/sdk-kmp/" target="_blank" rel="noopener noreferrer" class="dropdown__link">SDK Kotlin Multiplatform<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/input-output-hk/prism-did-method-spec/blob/main/w3c-spec/PRISM-method.md" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">PRISM DID Spec<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/adrs/">ADRs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/adrs/template">Template</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/adrs/decisions/2022-09-19-use-markdown-architectural-decision-records">Decisions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2022-09-19-use-markdown-architectural-decision-records">Use Markdown Architectural Decision Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2022-10-05-using-tapir-library-as-a-dsl-for-openapi-specification">Using tapir library as a DSL for OpenAPI specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2022-10-06-store-private-keys-of-issuers-inside-prism-agent">Store private keys of Issuers inside the Cloud Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-01-18-quill-library-for-sql-statement-generation">Quill library for SQL statement generation and validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-04-05-did-linked-resources">DID-linked-resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-05-09-message-routing-for-multi-tenant">Routing Requests to the Correct Tenant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-05-15-mediator-message-storage">Mediator message storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm">Hierarchical deterministic key generation algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-05-18-data-isolation-for-multitenancy">Data isolation for multi-tenancy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-05-27-use-keycloak-and-jwt-tokens-for-authentication-and-authorisation-to-facilitate-multitenancy-in-cloud-agent">Use Keycloak and JWT tokens for Authentication and Authorisation to facilitate multitenancy in the Cloud Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-06-28-apollo-as-centralised-and-secure-cryptography-management-module">Apollo as centralised and secure cryptography management module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-07-14-performance-framework-for-atala-prism">Performance framework for the Identus platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions">Use keycloak authorisation service for managing wallet permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2023-09-28-revocation-status-list-expansion-strategy">JWT credential revocation status list expansion strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2024-01-03-use-jwt-claims-for-agent-admin-auth">Use JWT claims for agent admin access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent">Error Handling Report Problem for Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2024-01-16-use-zio-failures-and-defects-effectively">Use ZIO Failures and Defects Effectively</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2024-03-07-handle-errors-in-bg-jobs-by-storing-on-state-records-and-sending-via-webhooks">Handle errors in background jobs by storing on state records and sending via webhooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/adrs/decisions/2024-05-20-use-did-urls-to-reference-resources">Storage for SSI related resources</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Decisions</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Use keycloak authorisation service for managing wallet permissions</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Use keycloak authorisation service for managing wallet permissions</h1>
<ul>
<li>Status: accepted</li>
<li>Decider: Pat Losoponkul, Yurii Shynbuiev, David Poltorak, Milos Dzepina</li>
<li>Date 2023-09-26</li>
<li>Tags: multitenancy, authorisation, authentication</li>
</ul>
<p>Technical Story: [External IAM provider integration for Authentication and Authorisation Layers MVP | <a href="https://input-output.atlassian.net/browse/ATL-5149" target="_blank" rel="noopener noreferrer">https://input-output.atlassian.net/browse/ATL-5149</a>]</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="context-and-problem-statement">Context and Problem Statement<a class="hash-link" aria-label="Direct link to Context and Problem Statement" title="Direct link to Context and Problem Statement" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#context-and-problem-statement">​</a></h2>
<p>As we move forward with multi-tenancy, it&#x27;s essential to give extra attention to authentication and authorisation.
Currently, our authentication and authorisation processes are managed by a simple built-in IAM implementation within the Cloud Agent.
While this setup is straightforward and functional, it&#x27;s a somewhat basic and proprietary approach.
Transitioning to an industry-standard IAM system like Keycloak represents an important step towards a more robust authentication and authorisation framework.</p>
<p>Within our multi-tenant Cloud Agent, we have some key concepts:
wallets (representing resources), entities (representing users), and authentication methods.
These models are integrated into our current IAM implementation within the agent allowing a loose coupling of users and resources, as well as resource access.</p>
<p>As we consider the shift towards an external IAM system, several important questions arise:</p>
<ol>
<li>Where to draw the boundary of AuthN/AuthZ across different components?</li>
<li>How to ensure smooth communication of wallet permissions across these components?</li>
<li>What will be the impact on the process of onboarding new users and wallets?</li>
</ol>
<p>These questions are essential as we explore the integration options of an external IAM  that suits our needs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision-drivers">Decision Drivers<a class="hash-link" aria-label="Direct link to Decision Drivers" title="Direct link to Decision Drivers" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#decision-drivers">​</a></h2>
<ul>
<li>Complexity to implement, operate and maintain</li>
<li>Must allow self-hosted option as well as future SaaS offering</li>
<li>Must allow flexible management of resources, users and permissions</li>
<li>Should adhere to standards in AuthN/AuthZ space</li>
<li>Should promote clear boundary between application and IAM concerns</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="considered-options">Considered Options<a class="hash-link" aria-label="Direct link to Considered Options" title="Direct link to Considered Options" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#considered-options">​</a></h2>
<ol>
<li>
<p>Keycloak for authentication and associate the wallet permissions on the Agent.</p>
<p>In this option, the agent validates the JWT from Keycloak, extracting the payload and obtain the user identity.
Then, the agent stores the user&#x27;s associated wallet information in its database.
Keycloak&#x27;s responsibility lies solely in user authentication, as permissions management is internally managed by the agent.</p>
</li>
<li>
<p>Keycloak for authentication and embed custom permission claims in the <code>access-token</code>.</p>
<p>In this option, the agent validates the JWT from Keycloak, extracting the payload containing custom claims related to the user&#x27;s accessible wallets.
Wallet permissions are managed in Keycloak as user metadata, which needs to be configured to include this claim in the issued JWT.</p>
</li>
<li>
<p>Keycloak for authentication and authorisation service  managing permissions.</p>
<p>In this option, the agent handles wallet resources on Keycloak using the <a href="https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_protection_api" target="_blank" rel="noopener noreferrer">Protection API</a>.
Wallet permissions are managed through Keycloak&#x27;s <a href="https://www.keycloak.org/docs/latest/authorization_services/index.html" target="_blank" rel="noopener noreferrer">authorisation service</a>.
When users intend to use the agent, it verifies wallet permissions by checking the Keycloak permission endpoint.
Similarly, Keycloak can also issue a self-contained JWT directly to users contains all the permission claims required by the agent.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision-outcome">Decision Outcome<a class="hash-link" aria-label="Direct link to Decision Outcome" title="Direct link to Decision Outcome" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#decision-outcome">​</a></h2>
<p>Use Keycloak authorisation service for managing wallet permissions.
Keycloak authorisation service offers a robust abstraction based on an industry-standard specification called UMA (User-Managed Access).
It allows us to define resources, resource owners, permissions, and policies with ease.
These concepts are tried and tested, and Keycloak provides them right out of the box, making it a suitable choice.
It is also the only option to adhere to the standard.</p>
<p>In this setup, applications are responsible for managing their resources and rely on
Keycloak for managing permissions on those resources.
To determine whether a user can access a specific resource, the application can simply utilise Keycloak&#x27;s permission endpoint.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="on-boarding-sequence-diagram">On-boarding sequence diagram<a class="hash-link" aria-label="Direct link to On-boarding sequence diagram" title="Direct link to On-boarding sequence diagram" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#on-boarding-sequence-diagram">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authorisation-sequence-diagram">Authorisation sequence diagram<a class="hash-link" aria-label="Direct link to Authorisation sequence diagram" title="Direct link to Authorisation sequence diagram" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#authorisation-sequence-diagram">​</a></h3>
<!-- -->
<p>Optionally, users or downstream applications can directly call Keycloak permission endpoint to get a RPT (requesting-party token)
to obtain a self-contained <code>access-token</code> which already include permissions.</p>
<p><strong>Endpoint references</strong></p>
<ul>
<li>Agent checks the user permissions using <a href="https://www.keycloak.org/docs/22.0.0/authorization_services/#_service_obtaining_permissions" target="_blank" rel="noopener noreferrer">permission endpoint</a>
<ul>
<li>[optional] Client may also directly call this endpoint on keycloak</li>
</ul>
</li>
<li>Agent registers a new resource using <a href="https://www.keycloak.org/docs/22.0.0/authorization_services/#_service_protection_resources_api" target="_blank" rel="noopener noreferrer">resource endpoints</a>
<ul>
<li><a href="https://www.keycloak.org/docs/22.0.0/authorization_services/#_service_protection_whatis_obtain_pat" target="_blank" rel="noopener noreferrer">obtain a token for the resource endpoints</a></li>
</ul>
</li>
<li>Admin manages the wallet permissions using both<!-- -->
<ul>
<li><a href="https://www.keycloak.org/docs/22.0.0/authorization_services/#_service_protection_permission_api_papi" target="_blank" rel="noopener noreferrer">Permission API</a></li>
<li><a href="https://www.keycloak.org/docs/22.0.0/authorization_services/#_service_authorization_uma_policy_api" target="_blank" rel="noopener noreferrer">Policy API</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive-consequences">Positive Consequences<a class="hash-link" aria-label="Direct link to Positive Consequences" title="Direct link to Positive Consequences" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#positive-consequences">​</a></h3>
<ul>
<li>Good separation between IAM and application concerns</li>
<li>Powerful and proven abstraction for managing permissions</li>
<li>Implementation is ready out of the box</li>
<li>Easy to migrate to different IAM vendor that supports UMA specification</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative-consequences">Negative Consequences<a class="hash-link" aria-label="Direct link to Negative Consequences" title="Direct link to Negative Consequences" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#negative-consequences">​</a></h3>
<ul>
<li>Require additional network call to obtain a permission token</li>
<li>Involves more moving parts in managing wallet permissions</li>
<li>Each IAM systems may have a slight variations to the UMA endpoints</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pros-and-cons-of-the-options">Pros and Cons of the Options<a class="hash-link" aria-label="Direct link to Pros and Cons of the Options" title="Direct link to Pros and Cons of the Options" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#pros-and-cons-of-the-options">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keycloak-for-authentication-and-associate-the-wallet-permissions-on-the-agent">Keycloak for authentication and associate the wallet permissions on the Agent<a class="hash-link" aria-label="Direct link to Keycloak for authentication and associate the wallet permissions on the Agent" title="Direct link to Keycloak for authentication and associate the wallet permissions on the Agent" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#keycloak-for-authentication-and-associate-the-wallet-permissions-on-the-agent">​</a></h3>
<ul>
<li>Good, because permission logic is on application and allowing any IAM solution to be used regardless of authorisation feature</li>
<li>Bad, because permissions are managed on the application and IAM boundary is blurred</li>
<li>Bad, because engineering effort is spent on non-differentiating value in order to have feature parity with other authorisation system</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keycloak-for-authentication-and-embed-custom-permission-claims-in-the-access-token">Keycloak for authentication and embed custom permission claims in the <code>access-token</code><a class="hash-link" aria-label="Direct link to keycloak-for-authentication-and-embed-custom-permission-claims-in-the-access-token" title="Direct link to keycloak-for-authentication-and-embed-custom-permission-claims-in-the-access-token" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#keycloak-for-authentication-and-embed-custom-permission-claims-in-the-access-token">​</a></h3>
<ul>
<li>Good, because the <code>access-token</code> is self-contained and doesn&#x27;t require extra network call</li>
<li>Good, because IAM systems are more likely to support custom claims feature</li>
<li>Bad, because the custom claims are directly linked to user instead of resource preventing flexible mangement of permission</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="links">Links<a class="hash-link" aria-label="Direct link to Links" title="Direct link to Links" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#links">​</a></h2>
<ul>
<li><a href="https://www.keycloak.org/docs/latest/authorization_services/index.html" target="_blank" rel="noopener noreferrer">Keycloak authorisation service</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/adrs/decisions/2023-07-14-performance-framework-for-atala-prism"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Performance framework for the Identus platform</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/adrs/decisions/2023-09-28-revocation-status-list-expansion-strategy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">JWT credential revocation status list expansion strategy</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#context-and-problem-statement">Context and Problem Statement</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#decision-drivers">Decision Drivers</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#considered-options">Considered Options</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#decision-outcome">Decision Outcome</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#on-boarding-sequence-diagram">On-boarding sequence diagram</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#authorisation-sequence-diagram">Authorisation sequence diagram</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#positive-consequences">Positive Consequences</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#negative-consequences">Negative Consequences</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#pros-and-cons-of-the-options">Pros and Cons of the Options</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#keycloak-for-authentication-and-associate-the-wallet-permissions-on-the-agent">Keycloak for authentication and associate the wallet permissions on the Agent</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#keycloak-for-authentication-and-embed-custom-permission-claims-in-the-access-token">Keycloak for authentication and embed custom permission claims in the <code>access-token</code></a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions#links">Links</a></li></ul></div></div></div></div></main></div></div></div><div class="container"><footer class="footer_J6tW"><svg xmlns="http://www.w3.org/2000/svg" width="145" height="38" fill="none"></svg><span class="copyright_C6JK">Hyperledger Identus CC BY 4.0</span></footer></div></div>
</body>
</html>