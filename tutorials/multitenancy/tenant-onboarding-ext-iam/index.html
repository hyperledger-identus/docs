<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-tutorials docs-version-current docs-doc-page docs-doc-id-multitenancy/tenant-onboarding-ext-iam" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Tenant Onboarding with External IAM | Hyperledger Identus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hyperledger.github.io/identus-docs/tutorials/multitenancy/tenant-onboarding-ext-iam"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-tutorials-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-tutorials-current"><meta data-rh="true" property="og:title" content="Tenant Onboarding with External IAM | Hyperledger Identus"><meta data-rh="true" name="description" content="In the Tenant Onboarding tutorial, we explored the basic IAM functionality out of the box."><meta data-rh="true" property="og:description" content="In the Tenant Onboarding tutorial, we explored the basic IAM functionality out of the box."><link data-rh="true" rel="icon" href="/identus-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hyperledger.github.io/identus-docs/tutorials/multitenancy/tenant-onboarding-ext-iam"><link data-rh="true" rel="alternate" href="https://hyperledger.github.io/identus-docs/tutorials/multitenancy/tenant-onboarding-ext-iam" hreflang="en"><link data-rh="true" rel="alternate" href="https://hyperledger.github.io/identus-docs/tutorials/multitenancy/tenant-onboarding-ext-iam" hreflang="x-default"><link rel="stylesheet" href="/identus-docs/assets/css/styles.3cf2f599.css">
<script src="/identus-docs/assets/js/runtime~main.f0622697.js" defer="defer"></script>
<script src="/identus-docs/assets/js/main.38474aa2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/identus-docs/"><div class="navbar__logo"><img src="/identus-docs/img/identus-navbar-light.png" alt=" Identus logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/identus-docs/img/identus-navbar-light.png" alt=" Identus logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/identus-docs/docs/getting-started">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/identus-docs/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/identus-docs/adrs/">ADRs</a><a class="navbar__item navbar__link" href="/identus-docs/agent-api/">Agent API</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">SDKs</a><ul class="dropdown__menu"><li><a href="https://hyperledger.github.io/identus-edge-agent-sdk-swift/documentation/edgeagentsdk/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Edge Agent SDK Swift<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/identus-docs/identus-edge-agent-sdk-ts/sdk">Edge Agent SDK Typescript</a></li><li><a href="https://hyperledger.github.io/identus-edge-agent-sdk-kmp/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Edge Agent SDK Kotlin Multiplatform<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/input-output-hk/prism-did-method-spec/blob/main/w3c-spec/PRISM-method.md" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">PRISM DID Spec<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/identus-docs/tutorials/">Tutorials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/identus-docs/tutorials/connections/connection">Connections</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/identus-docs/tutorials/category/credentials">Credentials</a><button aria-label="Expand sidebar category &#x27;Credentials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/identus-docs/tutorials/category/dids">DIDs</a><button aria-label="Expand sidebar category &#x27;DIDs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/identus-docs/tutorials/category/schemas">Schemas</a><button aria-label="Expand sidebar category &#x27;Schemas&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/identus-docs/tutorials/category/credential-definition">Credential Definition</a><button aria-label="Expand sidebar category &#x27;Credential Definition&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/identus-docs/tutorials/category/secret-management">Secret Management</a><button aria-label="Expand sidebar category &#x27;Secret Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/identus-docs/tutorials/webhooks/webhook">Webhooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/identus-docs/tutorials/multitenancy/tenant-onboarding">Multi-Tenancy</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/tutorials/multitenancy/tenant-onboarding">Tenant Onboarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/identus-docs/tutorials/multitenancy/tenant-onboarding-ext-iam">Tenant Onboarding with External IAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/tutorials/multitenancy/tenant-onboarding-self-service">Tenant Onboarding Self-Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/tutorials/multitenancy/tenant-migration">Migration from apikey to JWT authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/tutorials/multitenancy/admin-authz-ext-iam">Admin Authorization with External IAM</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/identus-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Multi-Tenancy</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tenant Onboarding with External IAM</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tenant Onboarding with External IAM</h1></header>
<p>In the <a href="/identus-docs/tutorials/multitenancy/tenant-onboarding">Tenant Onboarding</a> tutorial, we explored the basic <a href="/identus-docs/docs/concepts/glossary#iam">IAM</a> functionality out of the box.
Although it is usable and straightforward, more featureful tools are available for handling identity and access management.
The agent can seamlessly connect with <a href="/identus-docs/docs/concepts/glossary#keycloak-service">Keycloak</a> as an external IAM system, allowing the application built on top to utilize the capabilities that come with Keycloak.</p>
<p>The Cloud Agent leverages standard protocols like <a href="/identus-docs/docs/concepts/glossary#oidc">OIDC</a> and <a href="/identus-docs/docs/concepts/glossary#uma">UMA</a> for authentication and access management.
The user&#x27;s identity gets established through the ID token, and wallet permissions are searchable using the <a href="/identus-docs/docs/concepts/glossary#rpt">RPT (requesting party token)</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="roles">Roles<a href="#roles" class="hash-link" aria-label="Direct link to Roles" title="Direct link to Roles">​</a></h2>
<p>In tenant management with external IAM, there are 2 roles:</p>
<ol>
<li><a href="/identus-docs/docs/concepts/glossary#administrator">Administrator</a></li>
<li><a href="/identus-docs/docs/concepts/glossary#tenant">Tenant</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ol>
<li>Keycloak up and running</li>
<li>Keycloak is configured as follows<!-- -->
<ol>
<li>A realm called <code>my-realm</code> is created</li>
<li>A client called <code>cloud-agent</code> under <code>my-realm</code> with <strong>authorization</strong> feature is created. (See <a href="https://www.keycloak.org/docs/latest/authorization_services/index.html#_resource_server_create_client" target="_blank" rel="noopener noreferrer">create client instruction</a>)</li>
<li>Make sure the <code>cloud-agent</code> client has <strong>direct access grants</strong> enabled to simplify the login process for this tutorial</li>
</ol>
</li>
<li>the Cloud Agent is up and running</li>
<li>the Cloud Agent is configured with the following environment variables:<!-- -->
<ol>
<li><code>ADMIN_TOKEN=my-admin-token</code></li>
<li><code>DEFAULT_WALLET_ENABLED=false</code></li>
<li><code>KEYCLOAK_ENABLED=true</code></li>
<li><code>KEYCLOAK_URL=http://localhost:9980</code> (replace with appropriate value)</li>
<li><code>KEYCLOAK_REALM=my-realm</code></li>
<li><code>KEYCLOAK_CLIENT_ID=cloud-agent</code></li>
<li><code>KEYCLOAK_CLIENT_SECRET=&lt;KEYCLOAK_CLIENT_SECRET&gt;</code> (replace with appropriate value)</li>
<li><code>KEYCLOAK_UMA_AUTO_UPGRADE_RPT=false</code></li>
</ol>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This tutorial illustrates the process of provisioning a wallet resource for the new tenant and creating a tenant in Keycloak.
The administrator can then create a UMA permission for the wallet, giving access to the tenant.</p>
<p>When setting up UMA permissions on the agent, the wallet resource, along with the UMA policy and permission
are created on Keycloak according to a predefined convention.
For flexibility in defining custom policy and permission models,
administrators can manually create these UMA resources (resource, policy, permission) directly on Keycloak
using a set of UMA endpoints called <a href="/identus-docs/docs/concepts/glossary#protection-api">Protection API</a>  (see <a href="https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_protection_api" target="_blank" rel="noopener noreferrer">Keycloak Protection API</a>).
However, using Protection API to manage permissions is out of the scope of this tutorial.</p>
<p>Once the registration is successful, the tenant can obtain an ID token from Keycloak using any available OIDC flow,
such as the direct access grants (username &amp; password). This ID token typically contains user claims such as username and subject ID.
The tenant can use Keycloak&#x27;s token endpoint to convert this token to an RPT (requesting party token),
another token containing permissions information.
The tenant can access the multi-tenant agent by providing the RPT in the <code>Authorization</code> header.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="endpoints">Endpoints<a href="#endpoints" class="hash-link" aria-label="Direct link to Endpoints" title="Direct link to Endpoints">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="agent-endpoints">Agent endpoints<a href="#agent-endpoints" class="hash-link" aria-label="Direct link to Agent endpoints" title="Direct link to Agent endpoints">​</a></h3>
<table><thead><tr><th>Endpoint</th><th>Description</th><th>Role</th></tr></thead><tbody><tr><td><code>GET /wallets</code></td><td>List the wallets on the Cloud Agent</td><td>Administrator</td></tr><tr><td><code>POST /wallets</code></td><td>Create a new wallet on the Cloud Agent</td><td>Administrator</td></tr><tr><td><code>POST /wallets/{walletId}/uma-permissions</code></td><td>Create a uma-permission for a wallet</td><td>Administrator</td></tr><tr><td><code>GET /did-registrar/dids</code></td><td>List the DIDs inside the wallet</td><td>Tenant</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keycloak-endpoints">Keycloak endpoints<a href="#keycloak-endpoints" class="hash-link" aria-label="Direct link to Keycloak endpoints" title="Direct link to Keycloak endpoints">​</a></h3>
<table><thead><tr><th>Endpoint</th><th>Description</th><th>Role</th></tr></thead><tbody><tr><td><code>POST /admin/realms/{realm}/users</code></td><td>Create a new user on Keycloak</td><td>Administrator</td></tr><tr><td><code>POST /realms/{realm}/protocol/openid-connect/token</code></td><td>Issue a new JWT token</td><td>Administrator, Tenant</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="administrator-interactions">Administrator interactions<a href="#administrator-interactions" class="hash-link" aria-label="Direct link to Administrator interactions" title="Direct link to Administrator interactions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-check-the-existing-wallets">1. Check the existing wallets<a href="#1-check-the-existing-wallets" class="hash-link" aria-label="Direct link to 1. Check the existing wallets" title="Direct link to 1. Check the existing wallets">​</a></h3>
<p>When running Cloud Agent using the configurations above, the Cloud Agent should start with an empty state.
Listing wallets on it should return empty results.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X &#x27;GET&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:8080/cloud-agent/wallets&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;accept: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;x-admin-api-key: my-admin-token&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Response Example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;self&quot;: &quot;/wallets&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;kind&quot;: &quot;WalletPage&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;pageOf&quot;: &quot;/wallets&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;contents&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-a-new-wallet">2. Create a new wallet<a href="#2-create-a-new-wallet" class="hash-link" aria-label="Direct link to 2. Create a new wallet" title="Direct link to 2. Create a new wallet">​</a></h3>
<p>Create a wallet using a <code>POST /wallets</code> endpoint.
This wallet will be a container for the tenant&#x27;s assets (DIDs, VCs, Connections, etc.).
Provide a wallet seed during the wallet creation or let the Agent generate one</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X &#x27;POST&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:8080/cloud-agent/wallets&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;accept: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;x-admin-api-key: my-admin-token&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;seed&quot;: &quot;c9994785ce6d548134020f610b76102ca1075d3bb672a75ec8c9a27a7b8607e3b9b384e43b77bb08f8d5159651ae38b98573f7ecc79f2d7e1f1cc371ce60cf8a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;name&quot;: &quot;my-wallet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Response Example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;id&quot;: &quot;99734c87-5c9d-4697-b5fd-dea4e9590ba7&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;my-wallet&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;createdAt&quot;: &quot;2023-01-01T00:00:00Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;updatedAt&quot;: &quot;2023-01-01T00:00:00Z&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-user-registration-on-keycloak">3. User registration on Keycloak<a href="#3-user-registration-on-keycloak" class="hash-link" aria-label="Direct link to 3. User registration on Keycloak" title="Direct link to 3. User registration on Keycloak">​</a></h3>
<p>There are multiple ways to complete this step.
The goal is to ensure the user has registered on Keycloak.
Keycloak offers great flexibility, allowing users to self-register,
For this tutorial, we will generate the user manually using Keycloak admin API for simplicity.</p>
<p>The first step is to get an admin token from Keycloak using the username and password.
This token allows the admin to perform operations on Keycloak, such as creating a new user.
Running the provided command should return the admin access token.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X &#x27;POST&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:9980/realms/master/protocol/openid-connect/token&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;grant_type=password&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;client_id=admin-cli&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;username=$KEYCLOAK_ADMIN_USER&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;password=$KEYCLOAK_ADMIN_PASSWORD&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make sure to replace the Keycloak variables with appropriate values.</p>
<p>Example token response (some fields omitted for readability)</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;access_token&quot;: &quot;eyJhbGciOi...7ocDHofUDQ&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;refresh_token&quot;: &quot;eyJhbGciOi...otsEEi4eQA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After obtaining the <code>access_token</code> from Keycloak&#x27;s admin, a new user can be created using this command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X &#x27;POST&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:9980/admin/realms/my-realm/users&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Authorization: Bearer eyJhbGciOi...7ocDHofUDQ&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --data-raw &quot;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    \&quot;username\&quot;: \&quot;alice\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    \&quot;firstName\&quot;: \&quot;Alice\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    \&quot;enabled\&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    \&quot;credentials\&quot;: [{\&quot;value\&quot;: \&quot;1234\&quot;, \&quot;temporary\&quot;: false}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make sure to use the correct <code>access_token</code> in the <code>Authorization</code> header from the previous command.</p>
<p>Example response log</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt; HTTP/1.1 201 Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; Referrer-Policy: no-referrer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; X-Frame-Options: SAMEORIGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; Strict-Transport-Security: max-age=31536000; includeSubDomains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; X-Content-Type-Options: nosniff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; X-XSS-Protection: 1; mode=block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; Location: http://localhost:9980/admin/realms/my-realm/users/205e04b7-0158-41b0-89c3-f91c3a09f89b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt; content-length: 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The response should return status <code>201 Created</code> indicating the new user is registered with username <code>alice</code> with a password <code>1234</code>.
The user ID can be observed from <code>Location</code> header of the response. This ID will be used for creating permission later in this tutorial.</p>
<p>For in-depth user management, please consult the official Keycloak administration documentation on <a href="https://www.keycloak.org/docs/latest/server_admin/index.html#assembly-managing-users_server_administration_guide" target="_blank" rel="noopener noreferrer">managing users section</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-grant-the-user-permission-to-the-wallet">4. Grant the user permission to the wallet<a href="#4-grant-the-user-permission-to-the-wallet" class="hash-link" aria-label="Direct link to 4. Grant the user permission to the wallet" title="Direct link to 4. Grant the user permission to the wallet">​</a></h3>
<p>Once the user and wallet have been successfully created, the permissions can be created giving the user access to the wallet.
This can be done by invoking the <code>POST /wallets/{walletId}/uma-permissions</code> endpoint on the agent.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X &#x27;POST&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:8080/cloud-agent/wallets/99734c87-5c9d-4697-b5fd-dea4e9590ba7/uma-permissions&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;accept: */*&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;x-admin-api-key: my-admin-token&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;subject&quot;: &quot;205e04b7-0158-41b0-89c3-f91c3a09f89b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make sure to use the correct <code>subject</code> for the user and the correct <code>walletId</code> from the step earlier.
The user ID can be observed from the response header from the previous step or in the <strong>User</strong> menu in Keycloak Admin UI.</p>
<p>The response should return status <code>200 OK</code> in case of successful permission creation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tenant-interactions">Tenant interactions<a href="#tenant-interactions" class="hash-link" aria-label="Direct link to Tenant interactions" title="Direct link to Tenant interactions">​</a></h2>
<p>After the user is registered on Keycloak and the required permission is created by admin,
the tenant can log in and utilize the agent by using the token issued by Keycloak.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-obtain-access-token-from-keycloak">1. Obtain access token from Keycloak<a href="#1-obtain-access-token-from-keycloak" class="hash-link" aria-label="Direct link to 1. Obtain access token from Keycloak" title="Direct link to 1. Obtain access token from Keycloak">​</a></h3>
<p>The first step is to authenticate via Keycloak through any applicable authentication method.
Usually, the tenant will use some frontend application that follows the standard flow for logging in.
For simplicity, we use a flow for username and password in this tutorial.
The administrator has already set up the username and password for the tenant.
To get the access token, the tenant can call the Keycloak token endpoint directly with those credentials.</p>
<p>Run the command to log in</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X &#x27;POST&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:9980/realms/my-realm/protocol/openid-connect/token&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;grant_type=password&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;client_id=admin-cli&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;username=alice&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;password=1234&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Special attention on the <code>client_id</code>; this should be the actual <code>client_id</code> of the frontend application that logs the user in.
For this tutorial, it is OK to use <code>admin-cli</code>.</p>
<p>Example token response (some fields omitted for readability)</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;access_token&quot;: &quot;eyJhbGciOi...7ocDHofUDQ&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;refresh_token&quot;: &quot;eyJhbGciOi...otsEEi4eQA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-request-rpt-requesting-party-token-from-access-token">2. Request <a href="/identus-docs/docs/concepts/glossary#rpt">RPT (requesting party token)</a> from access token<a href="#2-request-rpt-requesting-party-token-from-access-token" class="hash-link" aria-label="Direct link to 2-request-rpt-requesting-party-token-from-access-token" title="Direct link to 2-request-rpt-requesting-party-token-from-access-token">​</a></h3>
<p>After the access token is acquired, the next step is to get the RPT token, which holds information about the permissions.
It is possible to request the RPT by running this command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;http://localhost:9980/realms/my-realm/protocol/openid-connect/token&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Authorization: Bearer eyJhbGciOi...7ocDHofUDQ&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;grant_type=urn:ietf:params:oauth:grant-type:uma-ticket&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &quot;audience=cloud-agent&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example token response (some fields omitted for readability)</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;access_token&quot;: &quot;eyJhbGciOi...e7H6W8RUvA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;refresh_token&quot;: &quot;eyJhbGciOi...W1_y1AF_YY&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After inspecting the response token, a new claim named <code>authorization</code> should appear in the JWT payload.</p>
<p>Example RPT payload (some fields omitted for readability)</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;authorization&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;permissions&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;rsid&quot;: &quot;99734c87-5c9d-4697-b5fd-dea4e9590ba7&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;rsname&quot;: &quot;&lt;WALLET_RESOURCE_NAME&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-perform-a-simple-action-to-verify-access-to-the-cloud-agent">3. Perform a simple action to verify access to the Cloud Agent<a href="#3-perform-a-simple-action-to-verify-access-to-the-cloud-agent" class="hash-link" aria-label="Direct link to 3. Perform a simple action to verify access to the Cloud Agent" title="Direct link to 3. Perform a simple action to verify access to the Cloud Agent">​</a></h3>
<p>To prove that the tenant can access the wallet using RPT,
try listing the DIDs in the wallet using RPT in the <code>Authorization</code> header.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location --request GET &#x27;http://localhost:8080/cloud-agent/did-registrar/dids&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Authorization: Bearer eyJhbGciOi...e7H6W8RUvA&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Accept: application/json&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make sure to replace the token with RPT from previous step.</p>
<p>The result should show 200 status with an empty list.
This means that the wallet has been created and does not contain any DIDs.
All actions carried out by the tenant must be limited to this specific wallet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-note-on-rpt">A note on RPT<a href="#a-note-on-rpt" class="hash-link" aria-label="Direct link to A note on RPT" title="Direct link to A note on RPT">​</a></h3>
<p>In this tutorial, there is an additional step for the tenant to request the RPT from the access token.
This process aligns with the standard UMA interaction, where the handling of RPT typically occurs on the client side.
To simplify the experience, the agent has a feature allowing users to bypass this process.
By setting the variable <code>KEYCLOAK_UMA_AUTO_UPGRADE_RPT=true</code>, tenants can utilize the access token
obtained in step 1 directly in the <code>Authorization</code> header, eliminating the need for additional RPT request step.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/identus-docs/tutorials/multitenancy/tenant-onboarding"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tenant Onboarding</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/identus-docs/tutorials/multitenancy/tenant-onboarding-self-service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tenant Onboarding Self-Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#roles" class="table-of-contents__link toc-highlight">Roles</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#endpoints" class="table-of-contents__link toc-highlight">Endpoints</a><ul><li><a href="#agent-endpoints" class="table-of-contents__link toc-highlight">Agent endpoints</a></li><li><a href="#keycloak-endpoints" class="table-of-contents__link toc-highlight">Keycloak endpoints</a></li></ul></li><li><a href="#administrator-interactions" class="table-of-contents__link toc-highlight">Administrator interactions</a><ul><li><a href="#1-check-the-existing-wallets" class="table-of-contents__link toc-highlight">1. Check the existing wallets</a></li><li><a href="#2-create-a-new-wallet" class="table-of-contents__link toc-highlight">2. Create a new wallet</a></li><li><a href="#3-user-registration-on-keycloak" class="table-of-contents__link toc-highlight">3. User registration on Keycloak</a></li><li><a href="#4-grant-the-user-permission-to-the-wallet" class="table-of-contents__link toc-highlight">4. Grant the user permission to the wallet</a></li></ul></li><li><a href="#tenant-interactions" class="table-of-contents__link toc-highlight">Tenant interactions</a><ul><li><a href="#1-obtain-access-token-from-keycloak" class="table-of-contents__link toc-highlight">1. Obtain access token from Keycloak</a></li><li><a href="#2-request-rpt-requesting-party-token-from-access-token" class="table-of-contents__link toc-highlight">2. Request RPT (requesting party token) from access token</a></li><li><a href="#3-perform-a-simple-action-to-verify-access-to-the-cloud-agent" class="table-of-contents__link toc-highlight">3. Perform a simple action to verify access to the Cloud Agent</a></li><li><a href="#a-note-on-rpt" class="table-of-contents__link toc-highlight">A note on RPT</a></li></ul></li></ul></div></div></div></div></main></div></div></div><div class="container"><footer class="footer_J6tW"><svg xmlns="http://www.w3.org/2000/svg" width="145" height="38" fill="none"></svg><span class="copyright_C6JK">Hyperledger Identus CC BY 4.0</span></footer></div></div>
</body>
</html>